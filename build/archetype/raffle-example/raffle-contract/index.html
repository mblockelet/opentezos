<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Raffle contract | OpenTezos</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://opentezos.com/archetype/raffle-example/raffle-contract"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Raffle contract | OpenTezos"><meta data-react-helmet="true" name="description" content="This section presents the Archetype version of the raffle contract, presented as well in the other languages (Ligo, Smartpy). A raffle is a gambling game, where players buy tickets; a winning ticket is randomly picked and its owner gets the jackpot prize."><meta data-react-helmet="true" property="og:description" content="This section presents the Archetype version of the raffle contract, presented as well in the other languages (Ligo, Smartpy). A raffle is a gambling game, where players buy tickets; a winning ticket is randomly picked and its owner gets the jackpot prize."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://opentezos.com/archetype/raffle-example/raffle-contract"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/archetype/raffle-example/raffle-contract" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/archetype/raffle-example/raffle-contract" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5fe771a9.css">
<link rel="preload" href="/assets/js/runtime~main.a0e3d78a.js" as="script">
<link rel="preload" href="/assets/js/main.af038137.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://gitlab.com/tezos-paris-hub/opentezos/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Gitlab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE" style="margin-left:2px">üåô</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE" style="margin-left:1px">‚òÄÔ∏è</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/">Welcome</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/blockchain-basics">Blockchain Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/tezos-basics">Tezos Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/deploy-a-node">Deploy a node</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/explorer">How to use an Explorer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/archetype">Archetype</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/archetype">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/archetype/completium">Completium</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" tabindex="0" href="/archetype/raffle-example/raffle-contract">Raffle example</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/archetype/raffle-example/raffle-contract">Raffle contract</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/archetype/raffle-example/unit-test">Testing</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/archetype/examples">Contract Templates</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/smartpy">SmartPy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/ligo">LIGO</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/michelson">Michelson</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/dapp">Build a Dapp</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/baking">Baking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/defi">DeFi</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/formal-verification">Formal Verification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/private">Private Blockchain</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/contribute">How to contribute</a></div></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Raffle contract</h1></header><p>This section presents the Archetype version of the <em>raffle</em> contract, presented as well in the other languages (<a href="/ligo/write-contract-ligo/1-raffle-contract#raffle-smart-contract">Ligo</a>, <a href="/smartpy/write-contract-smartpy#about-the-raffle-contract">Smartpy</a>). A raffle is a gambling game, where players buy tickets; a winning ticket is <em>randomly</em> picked and its owner gets the jackpot prize.</p><p>The <a href="/michelson">Michelson</a> machine does <strong>not</strong> provide an instruction to generate a random number though; and current contract date (<code>now</code> value) cannot be used for random number generation purpose either, because a baker could influence the process by selecting the time to generate the block.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The code source of the raffle contract and the test scenario are available in this <a href="https://gitlab.com/completium/archetype-raffle" target="_blank" rel="noopener noreferrer">repository</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="picking-the-winning-ticket">Picking the winning ticket<a aria-hidden="true" class="hash-link" href="#picking-the-winning-ticket" title="Direct link to heading">‚Äã</a></h2><p>The winning ticket id is obtained as the remainder of the euclidean division of an arbitraly large number, called here the <em>raffle key</em>, by the number of ticket buyers, called here <em>players</em>. For example, if the raffle key is 2022, and the number of raffle players is 87, then the winning ticket id is 21 (typically the 21st ticket).</p><p>The raffle key has several constraints:</p><ul><li>it cannot be publically hardcoded in the contract, because, if it is known by anyone, a player could influence the process by buying tickets until one of the tickets is the winning one.</li><li>it cannot either be known only by the admin, and passed by the admin to the contract when it is time to declare the winner. Indeed the admin could decide not to declare the winner.</li></ul><p>The solution is to keep the raffle key secret to everyone and then, when the raffle is closed, make it publically available so that anyone can transfer the jackpot to the winner. This is the purpose of the <a href="https://tezos.gitlab.io/alpha/timelock.html?highlight=timelock" target="_blank" rel="noopener noreferrer">timelock</a> encryption feature of the Michelson <code>chest</code> data type.</p><p>A <em>timelocked</em> value is encrypted so that it takes a certain amount of time (passed as an argument to the encryption process) for a descent machine to crack it. That is to say that, beyond a certain amount of time, the value may be considered public.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="raffle-storage">Raffle storage<a aria-hidden="true" class="hash-link" href="#raffle-storage" title="Direct link to heading">‚Äã</a></h2><p>The contract is parameterized as follows:</p><div class="codeBlockContainer_K1bP language-archetype"><div class="codeBlockContent_hGly archetype"><pre tabindex="0" class="prism-code language-archetype codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">archetype raffle(owner: address, min_duration : duration, jackpot : tez, ticket_price : tez)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>where:</p><ul><li><code>owner</code> is the address of the contract administrator</li><li><code>min_duration</code> is the minimum duration tickets can buy bought</li><li><code>jackpot</code> is the prize in tez</li><li><code>ticket_price</code> speaks for itslef</li></ul><p>The contract holds:</p><ul><li>the timelocked raffle key, initialized to <code>none</code>:</li></ul><div class="codeBlockContainer_K1bP language-archetype"><div class="codeBlockContent_hGly archetype"><pre tabindex="0" class="prism-code language-archetype codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">variable locked_raffle_key : option&lt;chest&gt;  = none</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>the date beyond which ticket cannot be bought, initialized to <code>none</code>:</li></ul><div class="codeBlockContainer_K1bP language-archetype"><div class="codeBlockContent_hGly archetype"><pre tabindex="0" class="prism-code language-archetype codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">variable close_date : option&lt;date&gt; = none</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>some information about the raffle, initialized to <code>none</code>:</li></ul><div class="codeBlockContainer_K1bP language-archetype"><div class="codeBlockContent_hGly archetype"><pre tabindex="0" class="prism-code language-archetype codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">variable desc : option&lt;string&gt; = none</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>the collection of the player addresses:</li></ul><div class="codeBlockContainer_K1bP language-archetype"><div class="codeBlockContent_hGly archetype"><pre tabindex="0" class="prism-code language-archetype codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">asset player {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id : address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>a state of 3 possible values:</li></ul><div class="codeBlockContainer_K1bP language-archetype"><div class="codeBlockContent_hGly archetype"><pre tabindex="0" class="prism-code language-archetype codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">states =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Created initial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Transferred</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>where:</p><ul><li><code>Created</code> is the initial state during which tickets cannot be bought yet</li><li><code>Running</code> is the state when the administrator opens the raffle for ticket selling</li><li><code>Transferred</code> is the state when prize has been transferred to the winner</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="entrypoints">Entrypoints<a aria-hidden="true" class="hash-link" href="#entrypoints" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="open"><code>open</code><a aria-hidden="true" class="hash-link" href="#open" title="Direct link to heading">‚Äã</a></h3><p>The <code>open</code> entrypoint is called by the contract admin (called &quot;owner&quot;). It requires that:</p><ul><li>the minimum duration be respected by the close date</li><li>the transferred amount of tez be equal to the storage value <code>jackpot</code></li></ul><p>It transition from <code>Created</code> state to <code>Running</code>, and sets the raffle parameters.</p><div class="codeBlockContainer_K1bP language-archetype"><div class="codeBlockContent_hGly archetype"><pre tabindex="0" class="prism-code language-archetype codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">transition open(cd : date, d : string, lrk : chest) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  called by owner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  require {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r0 : now + min_duration &lt; cd   otherwise &quot;INVALID_CLOSE_DATE&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r1 : transferred = jackpot     otherwise &quot;INVALID_AMOUNT&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  from Created to Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  with effect {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    locked_raffle_key := some(lrk);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_date        := some(cd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    desc              := some(d);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="buy"><code>buy</code><a aria-hidden="true" class="hash-link" href="#buy" title="Direct link to heading">‚Äã</a></h3><p>The <code>buy</code> entrypoint may be called by anyone to buy a ticket. It requires that:</p><ul><li>the contract be in <code>Running</code> state</li><li>the transferred amount of tez be equal to the ticket price</li><li>the close date be not reached</li></ul><p>It records the caller&#x27;s address in the <code>player</code> collection.</p><div class="codeBlockContainer_K1bP language-archetype"><div class="codeBlockContent_hGly archetype"><pre tabindex="0" class="prism-code language-archetype codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">entry buy () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  state is Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  require {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r2 : transferred = ticket_price otherwise &quot;INVALID_TICKET_PRICE&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r3 : now &lt; opt_get(close_date)  otherwise &quot;RAFFLE_CLOSED&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  effect { player.add({ caller }) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that the <code>add</code> method fails with the error <code>(Pair &quot;KeyExists&quot; &quot;player&quot;)</code> if the caller already has bought a ticket.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="transfer_prize"><code>transfer_prize</code><a aria-hidden="true" class="hash-link" href="#transfer_prize" title="Direct link to heading">‚Äã</a></h3><p>The <code>transfer_jackpot</code> may be called by anyone with the key to the <code>raffle_key</code> chest for the jackpot to be transferred to the winner. It requires that:</p><ul><li>the close date has been reached</li></ul><p>It also transitions the contract to the <code>Transferred</code> state and transfers the ticket amount to the contract&#x27;s owner.</p><div class="codeBlockContainer_K1bP language-archetype"><div class="codeBlockContent_hGly archetype"><pre tabindex="0" class="prism-code language-archetype codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">transition transfer_jackpot(k : chest_key, time : nat) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  require {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r4 : now &gt; opt_get(close_date) otherwise &quot;RAFFLE_OPEN&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  from Running to Transferred</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  with effect {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match open_chest(k, opt_get(locked_raffle_key), time) with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | left(unlocked) -&gt; begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var raffle_key = opt_get(unpack&lt;nat&gt;(unlocked));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        transfer jackpot to player.nth(raffle_key % player.count());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        transfer (balance - jackpot) to owner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        player.clear()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | right(error) -&gt; fail(&quot;INVALID_TIMELOCK&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://gitlab.com/tezos-paris-hub/opentezos/-/blob/main/docs/archetype/raffle-example/contract.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-02-13T15:12:21.000Z">2/13/2022</time></b> by <b>Benoit Rognier</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/archetype/completium"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ <!-- -->Completium</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/archetype/raffle-example/unit-test"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Testing<!-- --> ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#picking-the-winning-ticket" class="table-of-contents__link toc-highlight">Picking the winning ticket</a></li><li><a href="#raffle-storage" class="table-of-contents__link toc-highlight">Raffle storage</a></li><li><a href="#entrypoints" class="table-of-contents__link toc-highlight">Entrypoints</a><ul><li><a href="#open" class="table-of-contents__link toc-highlight"><code>open</code></a></li><li><a href="#buy" class="table-of-contents__link toc-highlight"><code>buy</code></a></li><li><a href="#transfer_prize" class="table-of-contents__link toc-highlight"><code>transfer_prize</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 OpenTezos.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a0e3d78a.js"></script>
<script src="/assets/js/main.af038137.js"></script>
</body>
</html>