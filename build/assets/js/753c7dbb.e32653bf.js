"use strict";(self.webpackChunkopentezos=self.webpackChunkopentezos||[]).push([[1289],{3905:function(e,a,c){c.d(a,{Zo:function(){return o},kt:function(){return p}});var t=c(7294);function n(e,a,c){return a in e?Object.defineProperty(e,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):e[a]=c,e}function d(e,a){var c=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),c.push.apply(c,t)}return c}function f(e){for(var a=1;a<arguments.length;a++){var c=null!=arguments[a]?arguments[a]:{};a%2?d(Object(c),!0).forEach((function(a){n(e,a,c[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(c)):d(Object(c)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(c,a))}))}return e}function b(e,a){if(null==e)return{};var c,t,n=function(e,a){if(null==e)return{};var c,t,n={},d=Object.keys(e);for(t=0;t<d.length;t++)c=d[t],a.indexOf(c)>=0||(n[c]=e[c]);return n}(e,a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(t=0;t<d.length;t++)c=d[t],a.indexOf(c)>=0||Object.prototype.propertyIsEnumerable.call(e,c)&&(n[c]=e[c])}return n}var l=t.createContext({}),r=function(e){var a=t.useContext(l),c=a;return e&&(c="function"==typeof e?e(a):f(f({},a),e)),c},o=function(e){var a=r(e.components);return t.createElement(l.Provider,{value:a},e.children)},i={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},s=t.forwardRef((function(e,a){var c=e.components,n=e.mdxType,d=e.originalType,l=e.parentName,o=b(e,["components","mdxType","originalType","parentName"]),s=r(c),p=n,u=s["".concat(l,".").concat(p)]||s[p]||i[p]||d;return c?t.createElement(u,f(f({ref:a},o),{},{components:c})):t.createElement(u,f({ref:a},o))}));function p(e,a){var c=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var d=c.length,f=new Array(d);f[0]=s;var b={};for(var l in a)hasOwnProperty.call(a,l)&&(b[l]=a[l]);b.originalType=e,b.mdxType="string"==typeof e?e:n,f[1]=b;for(var r=2;r<d;r++)f[r]=c[r];return t.createElement.apply(null,f)}return t.createElement.apply(null,c)}s.displayName="MDXCreateElement"},5926:function(e,a,c){c.r(a),c.d(a,{frontMatter:function(){return b},contentTitle:function(){return l},metadata:function(){return r},toc:function(){return o},default:function(){return s}});var t=c(7462),n=c(3366),d=(c(7294),c(3905)),f=["components"],b={id:"unit-test",title:"Testing",authors:"Benoit Rognier"},l=void 0,r={unversionedId:"archetype/raffle-example/unit-test",id:"archetype/raffle-example/unit-test",title:"Testing",description:"This section presents the testing of the raffle contract.",source:"@site/docs/archetype/raffle-example/test.md",sourceDirName:"archetype/raffle-example",slug:"/archetype/raffle-example/unit-test",permalink:"/opentezos/archetype/raffle-example/unit-test",editUrl:"https://gitlab.com/tezos-paris-hub/opentezos/-/blob/main/docs/archetype/raffle-example/test.md",tags:[],version:"current",lastUpdatedBy:"Benoit Rognier",lastUpdatedAt:1645708897,formattedLastUpdatedAt:"2/24/2022",frontMatter:{id:"unit-test",title:"Testing",authors:"Benoit Rognier"},sidebar:"docs",previous:{title:"Raffle contract",permalink:"/opentezos/archetype/raffle-example/raffle-contract"},next:{title:"Contract Templates",permalink:"/opentezos/archetype/examples"}},o=[{value:"Test scenario",id:"test-scenario",children:[],level:2},{value:"Mockup mode",id:"mockup-mode",children:[],level:2},{value:"Accounts",id:"accounts",children:[],level:2},{value:"Mockup time",id:"mockup-time",children:[],level:2},{value:"Raffle key chest",id:"raffle-key-chest",children:[{value:"Generate chest value",id:"generate-chest-value",children:[],level:3},{value:"Crack chest",id:"crack-chest",children:[],level:3}],level:2},{value:"Test script",id:"test-script",children:[{value:"Deploy contract",id:"deploy-contract",children:[],level:3},{value:"Call an entrypoint",id:"call-an-entrypoint",children:[],level:3},{value:"Expect to fail",id:"expect-to-fail",children:[],level:3},{value:"Check Balance",id:"check-balance",children:[],level:3}],level:2}],i={toc:o};function s(e){var a=e.components,c=(0,n.Z)(e,f);return(0,d.kt)("wrapper",(0,t.Z)({},i,c,{components:a,mdxType:"MDXLayout"}),(0,d.kt)("p",null,"This section presents the testing of the raffle contract."),(0,d.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,d.kt)("div",{parentName:"div",className:"admonition-heading"},(0,d.kt)("h5",{parentName:"div"},(0,d.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,d.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,d.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,d.kt)("div",{parentName:"div",className:"admonition-content"},(0,d.kt)("p",{parentName:"div"},"The code source of the raffle contract and the test scenario are available in this ",(0,d.kt)("a",{parentName:"p",href:"https://gitlab.com/completium/archetype-raffle"},"repository"),"."))),(0,d.kt)("h2",{id:"test-scenario"},"Test scenario"),(0,d.kt)("p",null,"The first time, run the following command to install the ",(0,d.kt)("a",{parentName:"p",href:"https://completium.com/docs/cli/jslibrary"},"Completium")," and ",(0,d.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/mocha"},"mocha")," libraries:"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-bash"},"npm i\n")),(0,d.kt)("p",null,"Run the test with:"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-bash"},"npm test\n")),(0,d.kt)("p",null,"The test scenario is made of 14 steps. Below is the trace returned by the command above:"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-bash"},"\n  Deploy\n    \u2714 Raffle\n\n  Open Raffle\n    \u2714 The unauthorized user Alice unsuccessfully calls 'initialise' entrypoint.\n    \u2714 Owner unsuccessfully calls 'initialise' entrypoint with wrong 'close_buy'.\n    \u2714 Owner unsuccessfully calls 'initialise' entrypoint with wrong 'reveal_fee'.\n    \u2714 Owner unsuccessfully calls 'initialise' entrypoint by sending not enough tez to the contract.\n    \u2714 Owner successfully calls 'initialise' entrypoint.\n    \u2714 Owner unsuccessfully calls 'initialise' entrypoint because a raffle is already initialised.\n\n  Test 'buy' entrypoint (at this point a raffle is open)\n    \u2714 Alice unsuccessfully calls 'buy' by sending a wrong amount of tez.\n    \u2714 Alice unsuccessfully calls 'buy' entrypoint because raffle is closed.\n    \u2714 Alice successfully calls 'buy' entrypoint.\n    \u2714 Alice unsuccessfully calls 'buy' entrypoint because she has already bought one.\n    \u2714 Jack successfully calls 'buy' entrypoint.\n    \u2714 Bob successfully calls 'buy' entrypoint.\n\n  Players reveal their raffle key (at this point a raffle is open and two players participated)\n    \u2714 Alice unsuccessfully calls 'reveal' entrypoint because it is before the 'close_date'.\n    \u2714 Alice unsuccessfully calls 'reveal' entrypoint because of an invalid chest key.\n    \u2714 Alice successfully calls 'reveal' entrypoint and gets the reveal fee.\n    \u2714 Alice unsuccessfully calls 'reveal' entrypoint because her raffle key is already revealed.\n    \u2714 Jack successfully calls 'reveal' entrypoint and gets the reveal fee.\n\n  Test 'transfer' entrypoint\n    \u2714 Owner unsucessfully calls 'transfer' entrypoint because Bob is not revealed.\n    \u2714 Owner sucessfully calls 'reveal' entrypoint to remove Bob's chest, and gets the unlock reward.\n    \u2714 Owner sucessfully calls 'transfer' entrypoint to send the jackpot to Jack.\n\n\n  21 passing (48s)\n")),(0,d.kt)("h2",{id:"mockup-mode"},"Mockup mode"),(0,d.kt)("p",null,"The Completium library allows running contracts on any network (mainnet, testnet, sandbox) but also in mockup mode."),(0,d.kt)("p",null,"Mockup mode runs contracts locally and quickly, so it is suitable for testing contracts. The following JS instruction activates the mockup mode within the test script:"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-js"},"setEndpoint('mockup')\n")),(0,d.kt)("h2",{id:"accounts"},"Accounts"),(0,d.kt)("p",null,"The mockup mode comes with a set of preconfigured test accounts. You can add any test account with the ",(0,d.kt)("inlineCode",{parentName:"p"},"import faucet")," or ",(0,d.kt)("inlineCode",{parentName:"p"},"generate")," CLI command."),(0,d.kt)("p",null,"Declare handlers to the required test accounts:"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-js"},"const alice = getAccount('alice');\nconst owner = getAccount('bootstrap1');\nconst jack  = getAccount('bootstrap2');\nconst bob   = getAccount('bootstrap3');\n")),(0,d.kt)("h2",{id:"mockup-time"},"Mockup time"),(0,d.kt)("p",null,"Use the ",(0,d.kt)("inlineCode",{parentName:"p"},"setMockupNow")," function to set the contract 'now' value:"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-js"},"const now = Math.floor(Date.now() / 1000)\nsetMockupNow(now)\n")),(0,d.kt)("h2",{id:"raffle-key-chest"},"Raffle key chest"),(0,d.kt)("p",null,"In this tutorial example, the ",(0,d.kt)("em",{parentName:"p"},"chest time")," parameter imposed by the contract is ",(0,d.kt)("inlineCode",{parentName:"p"},"10000000"),"."),(0,d.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,d.kt)("div",{parentName:"div",className:"admonition-heading"},(0,d.kt)("h5",{parentName:"div"},(0,d.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,d.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,d.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,d.kt)("div",{parentName:"div",className:"admonition-content"},(0,d.kt)("p",{parentName:"div"},"Note that it's probably ",(0,d.kt)("em",{parentName:"p"},"not")," a decent ",(0,d.kt)("em",{parentName:"p"},"chest time")," value since it takes only 20s to break on a standard computer ..."))),(0,d.kt)("h3",{id:"generate-chest-value"},"Generate chest value"),(0,d.kt)("p",null,"Player Alice's partial key is ",(0,d.kt)("inlineCode",{parentName:"p"},"123456"),", Player Jack's is ",(0,d.kt)("inlineCode",{parentName:"p"},"234567"),", and Player Bob is ",(0,d.kt)("inlineCode",{parentName:"p"},"345678"),"."),(0,d.kt)("p",null,"To get the timelocked value, the value is first packed (turned into bytes) with the following tezos client command ",(0,d.kt)("inlineCode",{parentName:"p"},"hash data"),":"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-bash"},"$ tezos-client -E https://hangzhounet.smartpy.io hash data '123456' of type nat\nWarning:\n\n                 This is NOT the Tezos Mainnet.\n\n           Do NOT use your fundraiser keys on this network.\n\nRaw packed data: 0x050080890f\n")),(0,d.kt)("p",null,"We then use the Completium ",(0,d.kt)("a",{parentName:"p",href:"https://github.com/completium/timelock-utils"},"timelock-utils")," tool to timelock the packed data:"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-bash"},'$ time ./timelock-utils --lock --data 050080890f --time 10000000\n{\n  "chest":\n    "c5ecdde89eb8c1e7aaeb85abb8f5e5cef3b4fa80c4aee2fccbf0a78ce0debaa5e9ddede3ddfbd9abdea28cc7dc99e6d3a9baf3cbae9adaaabc89cbc39e97e2c7a6cba99197d19ba09ddfd181afc997ffbcc5acb2d29ecbb698c2cacbdd83d1b4ced0bffe9cd78295b3fba4d9f9d5f4d4ec9ad3c7e1a8eeb9dba5cbd8a2dbf29af8e4a4c1e4b1edacf98fccefaef9fea4f0bacdd38ecbfe81c3f9839b9e9ab8fbf5f1eabac48a9f8ca7c588eefe94d1f18bd9bcee9aecde8dd285cf9098f4e1a7eec787f3a0e0ff9cd0ce8ec5a2a4e5ecb08fce899eb5baa397fabf90de9397cebc81bbdfb386e6b4da9fd8fdd19ed9f8d684c782b0aacfeebae4f6e7d1c5c1e6a093c68081cf83b991b4ecd7b38aee92deddcad79eb9abe0a0a0c6b5909dc58495f69445fff5ae9cefe8b8beb2fb86ccf5c9ad91989bdad8a3cfbedaffa2de8bf19dc6ac8cbc8a9584fa9f85f9ba958fc6bbc09ac8e7d5f0fdb98b86c1c7d59ad7c6dfc2d2cefaf5d9db909bf0e3acd3ccc792bc9bccbab4a4febda9b685dbc39ea2a4a7b69990d3abd8b9b3d7dbc581b984f3e08a98f7f7f0e697cc8dfd88edc8c3ca8dc3b2a9ccf6cdd6d0efcc848bc8ead5858bbabfcfc1c8ecea84fd9b96a5e4eabb8c918dafe6f78d83e8e1c2e5f8ee88a4ee8dcaeeafffebfcbbfda1e9eb86c582f2eedd9299cbc0a7fce083ced8c8ddb0e7eaacb696c1fccdadcdc8e3c6f7b9de84eece9bb7919094fef4fdf6efd8b1ba8bbecb9380add4f59ddbf9a19f95facc84e9d0a99bfa93f1fcc3a0fbde9b9ce0c7e8dec6e8d1dfa7dda6f490bb9580abfdbcc0e202e5ff731c3c17d080ee430edd30979a47aa653656e11e593800000015c2ca2a23b732a72932611618ad9ea324986377591e"\n  "key":\n    "94a4f28fcdc3ece3e1ddcbe0f3e1ebb3f3e19daaa286c09986efd1b787b7a0d9bef2dfc8c4a8e2ebf3f8e3bdcaa998c9a3fe9c8a97f7b4ccedcd87b39fe39585898feab5e49fd095beb4f5d6e897d6fba08c9e9bfa8b9de7f5c7a686c0838ce5bfa985d6db86b4c2c4acc2facd9ea6a6c9ecd18c89b3acd79897e5fbc8d2e7feacd08ca1ec9beed2c7c8f3d3b9c0f9a2b1ccc782fda5c282abe9dfac9686e8bde2d0c6e1d8d68b8cd79dfc98a9b79bf5ecaccfd8ced1bae0caa5e5e286fbe2fba7968dcad0d5db95c1f1908288bb849ca9d78fd0eeeabec38ff4b5d4b6b9b6e7fcb2d789e498e8dbd8ceebc4d7cecb9ca8afc1ede6fc87e199dfe6a887e5c7a094af8dafdebef2f8db8ccc95f29fc4f0daa8e0b8bbaf9afc9befa6b5fbbacecec88fe69302a4c79db7b58c9c9a989799e2b7fee8c4f583f785fddcf9e7b1b9f3c5e0beb6aba48180a9c2b1fdbdebeeaff3b68af882ebf08885bfc8dfb0a7af84e4d091f4b492dbeec9b5b9ff8ae8daee80ffa1b3948fe598d7d2a0e19fa98192a4c5a1d9f5a3cf93ded78a858d9cab86939dd0abfed1adcec7fabf9ed38edba08f80c8b1f9fffbb78fa8e8bcb79f89afa2bcc4fb91d5b9988fccd998cbcb849eccf893f49cad9ec4dfdaaab0d1a1e3abc3c187fddab8f1a49cea96f7efb1f1dec9988895c6fcb9aa8ba4dca59bb08089b6d396b4a7e883eccab2928cb5d3c5cfacabd0d2d19dfab3aee49cd7c0e38fa2b3b0f2acb0cac5a0d8b8d381c3ee88ebdce6eeaffaf3acf29eb8fae6f3e2e7d8f6fdb9c8dafe929bcfcee3add3c4efdcb88eefebfebfe3e1bd02"\n}\n./timelock-utils --lock --data 050080890f --time 10000000  0.10s user 0.02s system 97% cpu 0.126 total\n')),(0,d.kt)("p",null,"The timelock encryption generates a chest value, and the key to unlock it."),(0,d.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,d.kt)("div",{parentName:"div",className:"admonition-heading"},(0,d.kt)("h5",{parentName:"div"},(0,d.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,d.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,d.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,d.kt)("div",{parentName:"div",className:"admonition-content"},(0,d.kt)("p",{parentName:"div"},"In the test scenario, Bob generates the chest value with the wrong time value ",(0,d.kt)("inlineCode",{parentName:"p"},"10000001"),". As a result, the call to ",(0,d.kt)("inlineCode",{parentName:"p"},"reveal"),"  removes Bob as a player."))),(0,d.kt)("h3",{id:"crack-chest"},"Crack chest"),(0,d.kt)("p",null,"The following command is used to compute the chest key (ie. crack chest):"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-bash"},"$ time ./timelock-utils --create-chest-key --chest c5ecdde89eb8c1e7aaeb85abb8f5e5cef3b4fa80c4aee2fccbf0a78ce0debaa5e9ddede3ddfbd9abdea28cc7dc99e6d3a9baf3cbae9adaaabc89cbc39e97e2c7a6cba99197d19ba09ddfd181afc997ffbcc5acb2d29ecbb698c2cacbdd83d1b4ced0bffe9cd78295b3fba4d9f9d5f4d4ec9ad3c7e1a8eeb9dba5cbd8a2dbf29af8e4a4c1e4b1edacf98fccefaef9fea4f0bacdd38ecbfe81c3f9839b9e9ab8fbf5f1eabac48a9f8ca7c588eefe94d1f18bd9bcee9aecde8dd285cf9098f4e1a7eec787f3a0e0ff9cd0ce8ec5a2a4e5ecb08fce899eb5baa397fabf90de9397cebc81bbdfb386e6b4da9fd8fdd19ed9f8d684c782b0aacfeebae4f6e7d1c5c1e6a093c68081cf83b991b4ecd7b38aee92deddcad79eb9abe0a0a0c6b5909dc58495f69445fff5ae9cefe8b8beb2fb86ccf5c9ad91989bdad8a3cfbedaffa2de8bf19dc6ac8cbc8a9584fa9f85f9ba958fc6bbc09ac8e7d5f0fdb98b86c1c7d59ad7c6dfc2d2cefaf5d9db909bf0e3acd3ccc792bc9bccbab4a4febda9b685dbc39ea2a4a7b69990d3abd8b9b3d7dbc581b984f3e08a98f7f7f0e697cc8dfd88edc8c3ca8dc3b2a9ccf6cdd6d0efcc848bc8ead5858bbabfcfc1c8ecea84fd9b96a5e4eabb8c918dafe6f78d83e8e1c2e5f8ee88a4ee8dcaeeafffebfcbbfda1e9eb86c582f2eedd9299cbc0a7fce083ced8c8ddb0e7eaacb696c1fccdadcdc8e3c6f7b9de84eece9bb7919094fef4fdf6efd8b1ba8bbecb9380add4f59ddbf9a19f95facc84e9d0a99bfa93f1fcc3a0fbde9b9ce0c7e8dec6e8d1dfa7dda6f490bb9580abfdbcc0e202e5ff731c3c17d080ee430edd30979a47aa653656e11e593800000015c2ca2a23b732a72932611618ad9ea324986377591e --time 10000000\n94a4f28fcdc3ece3e1ddcbe0f3e1ebb3f3e19daaa286c09986efd1b787b7a0d9bef2dfc8c4a8e2ebf3f8e3bdcaa998c9a3fe9c8a97f7b4ccedcd87b39fe39585898feab5e49fd095beb4f5d6e897d6fba08c9e9bfa8b9de7f5c7a686c0838ce5bfa985d6db86b4c2c4acc2facd9ea6a6c9ecd18c89b3acd79897e5fbc8d2e7feacd08ca1ec9beed2c7c8f3d3b9c0f9a2b1ccc782fda5c282abe9dfac9686e8bde2d0c6e1d8d68b8cd79dfc98a9b79bf5ecaccfd8ced1bae0caa5e5e286fbe2fba7968dcad0d5db95c1f1908288bb849ca9d78fd0eeeabec38ff4b5d4b6b9b6e7fcb2d789e498e8dbd8ceebc4d7cecb9ca8afc1ede6fc87e199dfe6a887e5c7a094af8dafdebef2f8db8ccc95f29fc4f0daa8e0b8bbaf9afc9befa6b5fbbacecec88fe69302a4c79db7b58c9c9a989799e2b7fee8c4f583f785fddcf9e7b1b9f3c5e0beb6aba48180a9c2b1fdbdebeeaff3b68af882ebf08885bfc8dfb0a7af84e4d091f4b492dbeec9b5b9ff8ae8daee80ffa1b3948fe598d7d2a0e19fa98192a4c5a1d9f5a3cf93ded78a858d9cab86939dd0abfed1adcec7fabf9ed38edba08f80c8b1f9fffbb78fa8e8bcb79f89afa2bcc4fb91d5b9988fccd998cbcb849eccf893f49cad9ec4dfdaaab0d1a1e3abc3c187fddab8f1a49cea96f7efb1f1dec9988895c6fcb9aa8ba4dca59bb08089b6d396b4a7e883eccab2928cb5d3c5cfacabd0d2d19dfab3aee49cd7c0e38fa2b3b0f2acb0cac5a0d8b8d381c3ee88ebdce6eeaffaf3acf29eb8fae6f3e2e7d8f6fdb9c8dafe929bcfcee3add3c4efdcb88eefebfebfe3e1bd02\n./timelock-utils --create-chest-key --chest  --time 10000000  19.45s user 0.03s system 99% cpu 19.491 total\n")),(0,d.kt)("h2",{id:"test-script"},"Test script"),(0,d.kt)("h3",{id:"deploy-contract"},"Deploy contract"),(0,d.kt)("p",null,"Use the ",(0,d.kt)("inlineCode",{parentName:"p"},"deploy")," function to deploy the raffle contract."),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-js"},"let raffle;\n[raffle, _] = await deploy('./contract/raffle.arl', {\n    parameters: {\n        owner        : owner.pkh,\n        jackpot      : JACKPOT,\n        ticket_price : TICKET_PRICE,\n    },\n    as: owner.pkh\n});\n")),(0,d.kt)("h3",{id:"call-an-entrypoint"},"Call an entrypoint"),(0,d.kt)("p",null,"The ",(0,d.kt)("inlineCode",{parentName:"p"},"raffle")," contract object provides the entrypoints as object methods."),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-js"},"await raffle.initialise({\n    arg    : {\n      ob : OPEN_BUY,\n      cb : CLOSE_BUY,\n      cr : CLOSE_REVEAL,\n      t  : CHEST_TIME,\n      rf : REVEAL_FEE\n    },\n    as     : owner.pkh,\n    amount : JACKPOT\n})\n")),(0,d.kt)("h3",{id:"expect-to-fail"},"Expect to fail"),(0,d.kt)("p",null,"Use the ",(0,d.kt)("inlineCode",{parentName:"p"},"expectToThrow")," function to assert that the contract fails with a specified error value."),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-js"},"it(\"Alice unsuccessfully calls 'buy' by sending a wrong amount of tez.\", async () => {\n    await expectToThrow(async () => {\n      await raffle.buy({\n        arg : {\n          lrk  : ALICE_CHEST\n        }\n        as : alice.pkh\n      })\n    }, errors.INVALID_TICKET_PRICE)\n});\n")),(0,d.kt)("h3",{id:"check-balance"},"Check Balance"),(0,d.kt)("p",null,"Use the ",(0,d.kt)("inlineCode",{parentName:"p"},"checkBalanceDelta")," method to check the impact of an operation on an account balance."),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-js"},"await checkBalanceDelta(owner.pkh,  0, async () => {\nawait checkBalanceDelta(alice.pkh,  1, async () => {\nawait checkBalanceDelta(jack.pkh,   0, async () => {\n    await raffle.reveal({\n        arg : { k : ALICE_CHEST_KEY },\n        as : alice.pkh\n    })\n}) }) })\n")))}s.isMDXComponent=!0}}]);