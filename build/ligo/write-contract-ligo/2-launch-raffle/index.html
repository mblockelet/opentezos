<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Launch raffle | OpenTezos</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://opentezos.com/ligo/write-contract-ligo/2-launch-raffle"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Launch raffle | OpenTezos"><meta data-react-helmet="true" name="description" content="Smart Contract development: launch raffle entrypoint"><meta data-react-helmet="true" property="og:description" content="Smart Contract development: launch raffle entrypoint"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://opentezos.com/ligo/write-contract-ligo/2-launch-raffle"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/ligo/write-contract-ligo/2-launch-raffle" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/ligo/write-contract-ligo/2-launch-raffle" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5fe771a9.css">
<link rel="preload" href="/assets/js/runtime~main.ef81e5a8.js" as="script">
<link rel="preload" href="/assets/js/main.af038137.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://gitlab.com/tezos-paris-hub/opentezos/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Gitlab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE" style="margin-left:2px">üåô</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE" style="margin-left:1px">‚òÄÔ∏è</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/">Welcome</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/blockchain-basics">Blockchain Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/tezos-basics">Tezos Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/deploy-a-node">Deploy a node</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/explorer">How to use an Explorer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/archetype">Archetype</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/smartpy">SmartPy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/ligo">LIGO</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ligo">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/installation">Installation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" tabindex="0" href="/ligo/write-contract-ligo/1-raffle-contract">Raffle example</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/write-contract-ligo/1-raffle-contract">Raffle contract</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ligo/write-contract-ligo/2-launch-raffle">Launch raffle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/write-contract-ligo/3-buy-ticket">Buy ticket</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/write-contract-ligo/4-close-raffle">Close raffle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/write-contract-ligo/5-refactoring">Refactoring</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/deploy-a-contract">Compiling and deploying</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/unit-testing">Unit Testing with PyTezos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/examples">More examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/exam">Exam</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ligo/take-away">Take Away</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/michelson">Michelson</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/dapp">Build a Dapp</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/baking">Baking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/defi">DeFi</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/formal-verification">Formal Verification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/private">Private Blockchain</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/contribute">How to contribute</a></div></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Launch raffle</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="smart-contract-development-launch-raffle-entrypoint">Smart Contract development: launch raffle entrypoint<a aria-hidden="true" class="hash-link" href="#smart-contract-development-launch-raffle-entrypoint" title="Direct link to heading">‚Äã</a></h2><blockquote><p>LIGO concepts used in this part:
We are going to add our first entrypoint. We will need to dispatch the control flow in the main function. We are also going to complexify the storage with new types. Finally, we are going to implement some logic, check the access rights, raise an exception if they are not respected, and interact with some part of the Tezos blockchain. We will use:</p><ul><li>Record</li><li>Tuples</li><li>functions</li><li>Entrypoint</li><li>variant</li><li>pattern matching</li><li>if condition</li><li>failwith</li><li>types: addresses, timestamp</li><li>Tezos Module</li></ul></blockquote><p>Our LIGO code is compiling but is doing nothing: It has an empty storage, no parameter, and the smart contract returns an empty list of operations and an empty storage. As detailed in the previous chapter, the smart contract should perform three actions:</p><ol><li>launch a raffle</li><li>sell tickets (i.e., a caller can buy a ticket)</li><li>close the raffle, and reward the winner</li></ol><p>Each action will be coded into an entrypoint.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="ligo-concepts-used-in-this-part">LIGO concepts used in this part<a aria-hidden="true" class="hash-link" href="#ligo-concepts-used-in-this-part" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="records">Records<a aria-hidden="true" class="hash-link" href="#records" title="Direct link to heading">‚Äã</a></h4><p>The <code>record</code> type is a structure that holds several variables: each variable is referenced thanks to a field name.</p><p>Records are used:</p><ul><li>for the storage definition </li><li>for any object that should hold different types of information.</li></ul><p>For more details, see the <a href="https://ligolang.org/docs/language-basics/maps-records#records" target="_blank" rel="noopener noreferrer">Ligolang <code>record</code> documentation</a></p><h4 class="anchor anchorWithStickyNavbar_31ik" id="tuples">Tuples<a aria-hidden="true" class="hash-link" href="#tuples" title="Direct link to heading">‚Äã</a></h4><p>Tuples gather multiple fields into a single structure. A tuple data structure is ordered, which means we can access each tuple element by its position. Unlike <code>record</code> type, the tuple fields are unnamed.</p><p>Tuples are used:</p><ul><li>for the return type of the <strong>main</strong> function</li><li>for ordered data structures </li></ul><p>For more details, see the <a href="https://ligolang.org/docs/language-basics/sets-lists-tuples#tuples" target="_blank" rel="noopener noreferrer">Ligolang <code>tuple</code> documentation</a></p><h4 class="anchor anchorWithStickyNavbar_31ik" id="conditional-branching">Conditional branching<a aria-hidden="true" class="hash-link" href="#conditional-branching" title="Direct link to heading">‚Äã</a></h4><p>There are two ways to write <code>if</code> conditions:</p><ol><li>For a single expression:</li></ol><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isSmall</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> n </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> nat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> bool is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10n</span><span class="token plain"> then </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol><li>For more than a simple expression we use a <code>block</code> expression: </li></ol><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> y then </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> z </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> nat </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x </span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> skip</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For more details, see the <a href="https://ligolang.org/docs/language-basics/boolean-if-else#conditionals" target="_blank" rel="noopener noreferrer">Ligolang <code>if</code> documentation</a></p><h4 class="anchor anchorWithStickyNavbar_31ik" id="error-handling">Error handling<a aria-hidden="true" class="hash-link" href="#error-handling" title="Direct link to heading">‚Äã</a></h4><p>A smart contract can raise an exception that will stop the smart contract execution with the use of the keyword <code>failwith</code> (with an error message):</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">failwith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">string_message</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For more details, see the <a href="https://ligolang.org/docs/language-basics/exceptions" target="_blank" rel="noopener noreferrer">Ligolang <code>failwith</code> documentation</a></p><h4 class="anchor anchorWithStickyNavbar_31ik" id="interactions-with-a-tezos-network-tezos-module">Interactions with a Tezos network: Tezos Module<a aria-hidden="true" class="hash-link" href="#interactions-with-a-tezos-network-tezos-module" title="Direct link to heading">‚Äã</a></h4><p>The Tezos module is a set of LIGO instructions that query the state of the Tezos blockchain.</p><ul><li><code>Tezos.balance</code>: Get the balance for the contract.</li><li><code>Tezos.amount</code>: Get the amount of Tez provided by the sender to complete this transaction.</li><li><code>Tezos.sender</code>: Get the address that initiated the current transaction.</li><li><code>Tezos.self_address</code>: Get the address of the currently running contract.</li><li><code>Tezos.source</code>: Get the originator (address) of the current transaction. That is, if a chain of transactions led to an execution, you get the address that began the chain. Not to be confused with <code>Tezos.sender</code>, which gives the address of the contract or user which directly caused the current transaction.</li><li><code>Tezos.chain_id</code>: Get the identifier of the chain to distinguish between main and test chains.</li><li><code>Tezos.transaction</code>: create a transaction that will be sent at the end of the contract execution.</li></ul><p>For more details, see the <a href="https://ligolang.org/docs/reference/current-reference" target="_blank" rel="noopener noreferrer">Ligolang <code>Tezos module</code> documentation</a></p><h4 class="anchor anchorWithStickyNavbar_31ik" id="functions-in-ligo">Functions in ligo<a aria-hidden="true" class="hash-link" href="#functions-in-ligo" title="Direct link to heading">‚Äã</a></h4><p>LIGO functions are the basic building block of contracts. Each entrypoint of a contract executes a function and each smart contract must have at least one <strong>main</strong> function that dispatches the control flow to other functions.</p><p>When calling a function, LIGO makes a copy of the arguments but also of the environment variables.</p><p>Therefore, any modification to these will not be reflected outside the scope of the function and will be lost if they are not explicitly returned by the function.</p><p>There are two syntaxes for functions in PascaLigo, <em>Block Functions</em> and <em>Blockless Functions</em>.</p><h5 class="anchor anchorWithStickyNavbar_31ik" id="block-functions">Block functions<a aria-hidden="true" class="hash-link" href="#block-functions" title="Direct link to heading">‚Äã</a></h5><p>Block functions in PascaLigo are defined using the following syntax:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">parameters</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">return_type</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> is </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  block </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">operations and instructions</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">returned_value</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If a placeholder is needed, the instruction <code>skip</code> leaves the state unchanged. The rationale for <code>skip</code> instead of a genuinely empty block is that it prevents you from writing an empty block by mistake.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">parameters</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">return_type</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> is </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  block </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   skip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">returned_value</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_31ik" id="blockless-functions">Blockless functions<a aria-hidden="true" class="hash-link" href="#blockless-functions" title="Direct link to heading">‚Äã</a></h5><p>Functions containing all of their logic into a single expression can be defined without a block. The <code>add</code> function above can be re-written as a blockless function:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> a</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> int</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> b </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> int is a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> b</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For more details, see the <a href="https://ligolang.org/docs/language-basics/functions" target="_blank" rel="noopener noreferrer">Ligolang <code>functions</code> documentation</a></p><h4 class="anchor anchorWithStickyNavbar_31ik" id="dispatching-the-control-flow-in-the-main-function">Dispatching the control flow in the main function<a aria-hidden="true" class="hash-link" href="#dispatching-the-control-flow-in-the-main-function" title="Direct link to heading">‚Äã</a></h4><p>In LIGO, the design pattern is to have one <code>main</code> function that dispatches the control flow according to its parameters. The functions that can be invoked by those actions are called entrypoints. This is similar to the programming in <em>C</em>.</p><p>The parameter of the contract is then a <code>variant</code> type (described below), and depending on the constructors of that type, different functions in the contract are called. In other terms, the main function dispatches the control flow depending on a pattern matching the contract parameter.</p><h5 class="anchor anchorWithStickyNavbar_31ik" id="variant-type">Variant type<a aria-hidden="true" class="hash-link" href="#variant-type" title="Direct link to heading">‚Äã</a></h5><p>A variant type is a user-defined or built-in type (in case of <code>options</code>) that defines a type by cases. A number of cases are defined in the type definition. The value of a variable of this type must be included in these cases. The simplest variant type is equivalent to the enumerated types found in <em>Java</em>, <em>C++</em>, <em>JavaScript</em>, etc.</p><p>Here is how we define a <code>bit</code> as being either 1 or 0 (and nothing else):</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type bit is </span><span class="token maybe-class-name">One</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">Zero</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> closed_switch </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> bit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">One</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> open_switch </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> bit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Zero</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Entrypoints are defined within a variant type:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type entrypoints is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">firstEntrypoint</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">firstEntrypointParameterType</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">secondEntrypoint</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">secondEntrypointParameterType</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">nthEntrypoint</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">nthEntrypointParameterType</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_31ik" id="pattern-matching-variant-type-handling">Pattern Matching (Variant type handling)<a aria-hidden="true" class="hash-link" href="#pattern-matching-variant-type-handling" title="Direct link to heading">‚Äã</a></h5><p>Pattern matching can be used to route the program&#x27;s control flow based on the value of a <code>variant</code>. It is similar to the <code>switch</code> construct of many other languages. Consider for instance the definition of a power switch that turns a light on or off.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type bit is </span><span class="token maybe-class-name">One</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">Zero</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">power_switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> b </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> bit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> bit is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> b </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">One</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">Zero</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">Zero</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">One</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The control is performed this way:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type entrypoints is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">firstEntrypoint</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">firstEntrypointParameterType</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">secondEntrypoint</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">secondEntrypointParameterType</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">nthEntrypoint</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">nthEntrypointParameterType</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> action </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> entrypoints</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> store </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> storage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> returnType is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">block </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> returnType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> action </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">firstEntrypoint</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">param</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">firstEntrypointFunctionName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">param</span><span class="token punctuation" style="color:#393A34">.</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> param</span><span class="token punctuation" style="color:#393A34">.</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> param</span><span class="token punctuation" style="color:#393A34">.</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> param</span><span class="token punctuation" style="color:#393A34">.</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">secondEntrypoint</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">param</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">secondEntrypointFunctionName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">param</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">nthEntrypoint</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">param</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">nthEntrypointFunctionName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">param</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="customizing-the-raffle-storage">Customizing the Raffle storage<a aria-hidden="true" class="hash-link" href="#customizing-the-raffle-storage" title="Direct link to heading">‚Äã</a></h3><p>The first entrypoint of our Raffle smart contract illustrates the basics of PascaLigo, covered above.</p><p>Before coding the logic of the first action (opening a raffle session), the storage has to be modified to hold such a raffle. The contract needs an <strong>administrator</strong>: he will launch a raffle session, and provide a <strong>description</strong>. When the raffle is <strong>opened</strong>, it should be clearly noted in the storage. This raffle will need a <strong>reward</strong> and will be ongoing for a given <strong>time</strong>.</p><p>So, five variables are needed:</p><ul><li>the raffle administrator</li><li>a description of the raffle</li><li>a raffle opened boolean</li><li>the reward in tez</li><li>the raffle end date</li></ul><blockquote><p>What would be the types for each piece of information?</p></blockquote><p>For each variable, the corresponding type is:</p><ul><li>raffle administrator: address</li><li>raffle description: string</li><li>raffle opened : boolean</li><li>reward: tez</li><li>raffle end date: timestamp</li></ul><p>So far, the storage was empty, thanks to the <code>unit</code> type. The storage now needs to hold five variables of different types. Several values can be held in a <code>map</code>, but they must have the same type. Besides, <code>map</code> is not meant to keep the same number of elements.</p><p>The correct way to define a storage is to use the <code>record</code> type, as such:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type storage is record </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    admin </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_date </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> timestamp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jackpot </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> tez</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    raffle_is_open </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> bool</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="creating-a-raffle-session-entrypoint-definition">Creating a raffle session: entrypoint definition<a aria-hidden="true" class="hash-link" href="#creating-a-raffle-session-entrypoint-definition" title="Direct link to heading">‚Äã</a></h3><p>The contract storage can now hold a raffle session. The contract has to provide the users with a way of creating a raffle session. To do that, it needs an entrypoint that performs such an action: this new entrypoint should be named <code>OpenRaffle</code> and would allow the administrator to open a raffle.</p><p>So far, there is no entrypoint into this smart contract:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type raffleEntrypoints is unit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Adding the OpenRaffle entrypoint means defining the raffle entrypoint as a <code>variant</code>:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type raffleEntrypoints is </span><span class="token maybe-class-name">OpenRaffle</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> unit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>raffleEntrypoints</code> is now a variant: <code>OpenRaffle</code> does not expect any argument (because of <code>of unit</code>).</p><p>In order to be exposed, <code>OpenRaffle</code> needs to be handled in a pattern matching, in the main function:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> action </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> raffleEntrypoints</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> store </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> storage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  </span><span class="token function" style="color:#d73a49">list</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> storage is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> action </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">OpenRaffle</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nil</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>Notice that the contract <strong>parameter</strong> (<em>raffleEntrypoints</em> variant) is requiring no parameter (<code>unit</code>).
For now, this smart contract only has a single default entrypoint with no argument.
The <em>storage</em> type is used as the second parameter of the <em>main</em> function. </p></blockquote><p>Our smart contract now looks like this:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type raffleEntrypoints is </span><span class="token maybe-class-name">OpenRaffle</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> unit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type storage is record </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    admin </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_date </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> timestamp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jackpot </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> tez</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    raffle_is_open </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> bool</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type returnType is </span><span class="token function" style="color:#d73a49">list</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> action </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> raffleEntrypoints</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> store </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> storage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> returnType is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> action </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">OpenRaffle</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nil</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Despite the definition of a more complex storage, the execution of the smart contract still does nothing. The smart contract should at least require some parameters and update its storage.</p><p>To open a raffle, several variables have to be sent: the reward, the closing date, and a raffle description. Let&#x27;s define a type for these parameters:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type openRaffleParameter is tez </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> timestamp </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">option</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It is declared as a tuple:</p><ul><li><code>tez</code>: the amount of the reward</li><li><code>timestamp</code>: closing date</li><li><code>option(string)</code>: an optional description</li></ul><p>The <code>OpenRaffle</code> entrypoint must expect these parameters:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type openRaffleParameter is tez </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> timestamp </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">option</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type raffleEntrypoints is </span><span class="token maybe-class-name">OpenRaffle</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> openRaffleParameter</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Finally, the parameters must be added in the control flow in the main function:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">type openRaffleParameter is tez </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> timestamp </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">option</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type raffleEntrypoints is </span><span class="token maybe-class-name">OpenRaffle</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> openRaffleParameter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type storage is record </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    admin </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_date </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> timestamp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jackpot </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> tez</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    raffle_is_open </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> bool</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type returnType is </span><span class="token function" style="color:#d73a49">list</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> action </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> raffleEntrypoints</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> store </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> storage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> returnType is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> action </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function maybe-class-name" style="color:#d73a49">OpenRaffle</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">param</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nil</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This outputs some Michelson code that does nothing, but there is a slight change in the parameter section:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">{ parameter (pair (pair mutez timestamp) (option string)) ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  storage int ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  code { CDR ; NIL operation ; PAIR } }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>openRaffleParameter</code> is expected in the parameter section.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="adding-the-openraffle-logic">Adding the OpenRaffle logic<a aria-hidden="true" class="hash-link" href="#adding-the-openraffle-logic" title="Direct link to heading">‚Äã</a></h3><p>The last step is to implement the logic of this entrypoint, in a function, which will update the storage.</p><p>Let&#x27;s create an empty function. This function expects the three needed parameters, and returns the standard list of operations and the updated store:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">open_raffle</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> jackpot_amount </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> tez</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> close_date </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> timestamp</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> description </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter function" style="color:#d73a49">option</span><span class="token parameter punctuation" style="color:#393A34">(</span><span class="token parameter">string</span><span class="token parameter punctuation" style="color:#393A34">)</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> store </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> storage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> returnType is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    block </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> skip </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nil</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The first step is to check if the entrypoint is called by the administrator. If not, it should raise an exception. The check is performed by the association of an <code>if</code> condition and a <code>failwith</code>. The address calling the entrypoint should match the address in the storage. This is called access control.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">open_raffle</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> jackpot_amount </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> tez</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> close_date </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> timestamp</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> description </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter function" style="color:#d73a49">option</span><span class="token parameter punctuation" style="color:#393A34">(</span><span class="token parameter">string</span><span class="token parameter punctuation" style="color:#393A34">)</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> store </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> storage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> returnType is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    block </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token maybe-class-name">Tezos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">/=</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">admin</span><span class="token plain"> then </span><span class="token function" style="color:#d73a49">failwith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;administrator not recognized&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        skip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nil</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A second check has to be performed: a raffle cannot be opened if the previous one has not yet closed. A boolean gives this value in the storage: <code>raffle_is_open</code></p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">open_raffle</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> jackpot_amount </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> tez</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> close_date </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> timestamp</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> description </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter function" style="color:#d73a49">option</span><span class="token parameter punctuation" style="color:#393A34">(</span><span class="token parameter">string</span><span class="token parameter punctuation" style="color:#393A34">)</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> store </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> storage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> returnType is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    block </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token maybe-class-name">Tezos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">/=</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">admin</span><span class="token plain"> then </span><span class="token function" style="color:#d73a49">failwith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Administrator not recognized.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> not store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">raffle_is_open</span><span class="token plain"> then </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            skip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">failwith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;A raffle is already open.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nil</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A third check is performed on the reward: the funds sent must match the raffle reward.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">open_raffle</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> jackpot_amount </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> tez</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> close_date </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> timestamp</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> description </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter function" style="color:#d73a49">option</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">(</span><span class="token parameter">string</span><span class="token parameter punctuation" style="color:#393A34">)</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> store </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> storage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> returnType is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  block </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token maybe-class-name">Tezos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">/=</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">admin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    then </span><span class="token function" style="color:#d73a49">failwith</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Administrator not recognized.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> not store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">raffle_is_open</span><span class="token plain"> then </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token maybe-class-name">Tezos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">amount</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> jackpot_amount then </span><span class="token function" style="color:#d73a49">failwith</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;The administrator does not own enough tez.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            skip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">failwith</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;A raffle is already open.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nil </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">list</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>One final check is performed on the raffle closing date: the raffle should last at least a week.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">open_raffle</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> jackpot_amount </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> tez</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> close_date </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> timestamp</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> description </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter function" style="color:#d73a49">option</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">(</span><span class="token parameter">string</span><span class="token parameter punctuation" style="color:#393A34">)</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> store </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> storage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> returnType is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  block </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token maybe-class-name">Tezos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">/=</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">admin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    then </span><span class="token function" style="color:#d73a49">failwith</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Administrator not recognized.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> not store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">raffle_is_open</span><span class="token plain"> then </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token maybe-class-name">Tezos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">amount</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> jackpot_amount then </span><span class="token function" style="color:#d73a49">failwith</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;The administrator does not own enough tez.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> today </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> timestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Tezos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">now</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> seven_day </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">86400</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> in_7_day </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> timestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> today </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> seven_day</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> is_close_date_not_valid </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> bool </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> close_date </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> in_7_day</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> is_close_date_not_valid then </span><span class="token function" style="color:#d73a49">failwith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;The raffle must remain open for at least 7 days.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            skip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">failwith</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;A raffle is already open.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nil </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">list</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We need to store the variables about the raffle: the reward, the closing date and the raffle description. In addition, the storage should indicate that there&#x27;s an ongoing raffle. The storage needs to be updated with these variables. </p><blockquote><p>Note how the description is added to the storage as an <code>option</code>.</p></blockquote><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">open_raffle</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> jackpot_amount </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> tez</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> close_date </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> timestamp</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> description </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter function" style="color:#d73a49">option</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">(</span><span class="token parameter">string</span><span class="token parameter punctuation" style="color:#393A34">)</span><span class="token parameter punctuation" style="color:#393A34">;</span><span class="token parameter"> </span><span class="token parameter keyword" style="color:#00009f">const</span><span class="token parameter"> store </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> storage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> returnType is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  block </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token maybe-class-name">Tezos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">/=</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">admin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    then </span><span class="token function" style="color:#d73a49">failwith</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Administrator not recognized.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> not store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">raffle_is_open</span><span class="token plain"> then </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token maybe-class-name">Tezos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">amount</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> jackpot_amount then </span><span class="token function" style="color:#d73a49">failwith</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;The administrator does not own enough tz.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> today </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> timestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Tezos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">now</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> seven_day </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> int </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">86400</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> in_7_day </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> timestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> today </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> seven_day</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> is_close_date_not_valid </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> bool </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> close_date </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> in_7_day</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> is_close_date_not_valid then </span><span class="token function" style="color:#d73a49">failwith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;The raffle must remain open for at least 7 days.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            patch store </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> record </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            jackpot </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jackpot_amount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            close_date </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> close_date</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            raffle_is_open </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">True</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> description </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token function maybe-class-name" style="color:#d73a49">Some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> patch store </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> record </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">description</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">d</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">None</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">skip</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">failwith</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;A raffle is already open.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nil </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">list</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>Keep in mind:</p><ul><li>check entrypoint inputs as much as possible</li><li>the storage can be updated in an entrypoint</li></ul></blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://gitlab.com/tezos-paris-hub/opentezos/-/blob/main/docs/ligo/write-contract-ligo/2-launch-raffle.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-08-06T00:27:39.000Z">8/6/2021</time></b> by <b>Aymeric</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ligo/write-contract-ligo/1-raffle-contract"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ <!-- -->Raffle contract</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ligo/write-contract-ligo/3-buy-ticket"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Buy ticket<!-- --> ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#smart-contract-development-launch-raffle-entrypoint" class="table-of-contents__link toc-highlight">Smart Contract development: launch raffle entrypoint</a><ul><li><a href="#ligo-concepts-used-in-this-part" class="table-of-contents__link toc-highlight">LIGO concepts used in this part</a></li><li><a href="#customizing-the-raffle-storage" class="table-of-contents__link toc-highlight">Customizing the Raffle storage</a></li><li><a href="#creating-a-raffle-session-entrypoint-definition" class="table-of-contents__link toc-highlight">Creating a raffle session: entrypoint definition</a></li><li><a href="#adding-the-openraffle-logic" class="table-of-contents__link toc-highlight">Adding the OpenRaffle logic</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 OpenTezos.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ef81e5a8.js"></script>
<script src="/assets/js/main.af038137.js"></script>
</body>
</html>