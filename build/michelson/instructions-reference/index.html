<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Instructions Reference | OpenTezos</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://opentezos.com/opentezos/michelson/instructions-reference"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Instructions Reference | OpenTezos"><meta data-react-helmet="true" name="description" content="This chapter provides an explicit list of all the most commonly used instructions in Michelson. It intends to describe common Michelson instructions with a graphical illustration."><meta data-react-helmet="true" property="og:description" content="This chapter provides an explicit list of all the most commonly used instructions in Michelson. It intends to describe common Michelson instructions with a graphical illustration."><link data-react-helmet="true" rel="icon" href="/opentezos/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://opentezos.com/opentezos/michelson/instructions-reference"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/opentezos/michelson/instructions-reference" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/opentezos/michelson/instructions-reference" hreflang="x-default"><link rel="stylesheet" href="/opentezos/assets/css/styles.5fe771a9.css">
<link rel="preload" href="/opentezos/assets/js/runtime~main.aaa8e9f6.js" as="script">
<link rel="preload" href="/opentezos/assets/js/main.c790d287.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/opentezos/"><div class="navbar__logo"><img src="/opentezos/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/opentezos/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://gitlab.com/tezos-paris-hub/opentezos/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Gitlab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE" style="margin-left:2px">üåô</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE" style="margin-left:1px">‚òÄÔ∏è</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/">Welcome</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/blockchain-basics">Blockchain Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/tezos-basics">Tezos Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/deploy-a-node">Deploy a node</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/explorer">How to use an Explorer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/archetype">Archetype</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/smartpy">SmartPy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/ligo">LIGO</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/opentezos/michelson">Michelson</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/opentezos/michelson">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/opentezos/michelson/smart-contracts">Smart Contracts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/opentezos/michelson/tutorial">Tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/opentezos/michelson/examples">Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/opentezos/michelson/instructions-reference">Instructions Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/opentezos/michelson/exam">Exam</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/opentezos/michelson/take-away">Take away</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/dapp">Build a Dapp</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/baking">Baking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/defi">DeFi</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/formal-verification">Formal Verification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/private">Private Blockchain</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/opentezos/contribute">How to contribute</a></div></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Instructions Reference</h1></header><p>This chapter provides an explicit list of all the most commonly used instructions in Michelson. It intends to describe common Michelson instructions with a graphical illustration.</p><p><strong>It is not intended for you to be read as is but to be used as a reference during your developments.</strong></p><p>An exhaustive list of Michelson instructions, with a full detailed description, is available on the official reference website (<a href="https://tezos.gitlab.io/michelson-reference/" target="_blank" rel="noopener noreferrer">https://tezos.gitlab.io/michelson-reference/</a>).</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="instructions">Instructions<a aria-hidden="true" class="hash-link" href="#instructions" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="stack-operations">Stack operations<a aria-hidden="true" class="hash-link" href="#stack-operations" title="Direct link to heading">‚Äã</a></h3><p>Some generic operators allow elements in a stack to be manipulated, such as moving an element into the stack or moving, copying, and removing elements from the stack. </p><h4 class="anchor anchorWithStickyNavbar_31ik" id="push-instruction">PUSH instruction<a aria-hidden="true" class="hash-link" href="#push-instruction" title="Direct link to heading">‚Äã</a></h4><p>The <code>PUSH</code> instruction allows an element to be placed on top of the stack.</p><p>It requires the type of pushed element be specified.</p><p><img src="/opentezos/assets/images/michelson_instruction_push_example-212622adb38ae9bcbe26ab899c65d5d7.svg"></p><small class="figure">FIGURE 2: Illustration of the `PUSH` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="unit-instruction">UNIT instruction<a aria-hidden="true" class="hash-link" href="#unit-instruction" title="Direct link to heading">‚Äã</a></h4><p>The <code>UNIT</code> instruction pushes a <code>Unit</code> value on top of the stack.</p><p>The <code>Unit</code> value represents no value.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="drop-instruction">DROP instruction<a aria-hidden="true" class="hash-link" href="#drop-instruction" title="Direct link to heading">‚Äã</a></h4><p>The <code>DROP</code> instruction removes the top element of the stack</p><p><img src="/opentezos/assets/images/michelson_instruction_drop_example-504b5a7eadac4a84353f9d079dc0e137.svg"></p><small class="figure">FIGURE 3: Illustration of the `DROP` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="swap-instruction">SWAP instruction<a aria-hidden="true" class="hash-link" href="#swap-instruction" title="Direct link to heading">‚Äã</a></h4><p>The <code>SWAP</code> instruction inverts the position of the top two elements of the stack.</p><p><img src="/opentezos/assets/images/michelson_instruction_swap_example-f8ab1903def5f30ecaa8a953a0790027.svg"></p><small class="figure">FIGURE 4: Illustration of the `SWAP` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="dup-instruction">DUP instruction<a aria-hidden="true" class="hash-link" href="#dup-instruction" title="Direct link to heading">‚Äã</a></h4><p>The <code>DUP</code> instruction duplicates the top element of the stack</p><p><img src="/opentezos/assets/images/michelson_instruction_dup_example-f2a97d8c62fc429aff0dca5370d989aa.svg"></p><small class="figure">FIGURE 5: Illustration of the `DUP` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="dig-instruction">DIG instruction<a aria-hidden="true" class="hash-link" href="#dig-instruction" title="Direct link to heading">‚Äã</a></h4><p>The <code>DIG n</code> instruction moves the n-th element of the stack to the top of the stack.</p><p><img src="/opentezos/assets/images/michelson_instruction_dig_example-0c1f6744d93fa7c896ec6bfc70181417.svg"></p><small class="figure">FIGURE 6: Illustration of the `DIG` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="dug-instruction">DUG instruction<a aria-hidden="true" class="hash-link" href="#dug-instruction" title="Direct link to heading">‚Äã</a></h4><p>The <code>DUG n</code> instruction moves the top element of the stack to the n-th element of the stack.</p><p><img src="/opentezos/assets/images/michelson_instruction_dug_example-a4bcecd1511e67965798974cb42ddf03.svg"></p><small class="figure">FIGURE 7: Illustration of the `DUG` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="dip-instruction">DIP instruction<a aria-hidden="true" class="hash-link" href="#dip-instruction" title="Direct link to heading">‚Äã</a></h4><p>The <code>DIP</code> instruction takes two arguments:</p><ul><li><em>n</em>: a number of elements to protect (by default 1)</li><li><em>code</em>: a sequence of instructions to execute</li></ul><p>It runs the provided sequence of instructions while protecting the <em>n</em> top elements of the stack.</p><p>There is a special case when n = 1. An alias (shortcut) is available for this case, the <code>DIP code</code> instruction is equivalent to <code>DIP 1 code</code>.</p><p>Also notice that <code>DIP 0 code</code> is equivalent to <code>code</code></p><p><img src="/opentezos/assets/images/michelson_instruction_dip_example-1b840feb7826991e288d1019d0dfc10e.svg"></p><small class="figure">FIGURE 8: Illustration of the `DIP` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="lambda">LAMBDA<a aria-hidden="true" class="hash-link" href="#lambda" title="Direct link to heading">‚Äã</a></h4><p>The <code>LAMBDA</code> instruction pushes a function on top of the stack.</p><p>It requires three arguments:</p><ul><li>the type of the function argument</li><li>the type returned by the function</li><li>the sequence of instructions associated with the function (code of the function)</li></ul><p>Here is an example of a smart contract that defines a function with the <code>LAMBDA</code> instruction and executes the function with the <code>EXEC</code> instruction.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">parameter int </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storage int </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">LAMBDA</span><span class="token plain"> int int </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PUSH</span><span class="token plain"> int </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">EXEC</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>lambda</code> function is just incrementing a given int.</p><p>The execution of this smart contract is described in the example section.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="generic-comparison">Generic comparison<a aria-hidden="true" class="hash-link" href="#generic-comparison" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="compare">COMPARE<a aria-hidden="true" class="hash-link" href="#compare" title="Direct link to heading">‚Äã</a></h4><p>This instruction compares the top two elements of the stack.</p><p>The <code>COMPARE</code> instruction returns -1 if the first element is smaller than the second one. It returns 0 if the two first elements are equal. Otherwise it returns 1.</p><p>Here is an example of a comparison between two natural integers:</p><p><img src="/opentezos/assets/images/michelson_instruction_compare_example-e697aa4e8764e371664efa7ac5b87350.svg"></p><small class="figure">FIGURE 9: Illustration of the `COMPARE` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="eq">EQ<a aria-hidden="true" class="hash-link" href="#eq" title="Direct link to heading">‚Äã</a></h4><p>The top element is replaced by <em>True</em> if this element is zero, otherwise by <em>False</em>. </p><p>Here is an example:</p><p><img src="/opentezos/assets/images/michelson_instruction_eq_example-ebb295907a9f28c40cbf50c232e0ed70.svg"></p><small class="figure">FIGURE 10: Illustration of the `EQ` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="lt">LT<a aria-hidden="true" class="hash-link" href="#lt" title="Direct link to heading">‚Äã</a></h4><p>The top element is replaced by <em>True</em> if this element is lower than zero, otherwise by <em>False</em>. </p><p>Here is an example:</p><p><img src="/opentezos/assets/images/michelson_instruction_lt_example-58fd600baee81824b269075e056106ea.svg"></p><small class="figure">FIGURE 11: Illustration of the `LT` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="ge">GE<a aria-hidden="true" class="hash-link" href="#ge" title="Direct link to heading">‚Äã</a></h4><p>The top element is replaced by <em>True</em> if this element is greater or equal to zero, otherwise by <em>False</em>. </p><p>Here is an example:</p><p><img src="/opentezos/assets/images/michelson_instruction_ge_example-a14f4b60a347c7e727dd004afbaefe39.svg"></p><small class="figure">FIGURE 12: Illustration of the `GE` instruction</small><h3 class="anchor anchorWithStickyNavbar_31ik" id="operations-on-bool">Operations on bool<a aria-hidden="true" class="hash-link" href="#operations-on-bool" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="or">OR<a aria-hidden="true" class="hash-link" href="#or" title="Direct link to heading">‚Äã</a></h4><p>The <code>OR</code> instruction consumes the top two elements of the stack and computes a logical <em>OR</em> of both elements.</p><p><img src="/opentezos/assets/images/michelson_instruction_or_example-8c499ecad23c5af1da00b089eead699f.svg"></p><small class="figure">FIGURE 13: Illustration of the `OR` instruction</small><p>The <code>OR</code> instruction requires boolean elements.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="and">AND<a aria-hidden="true" class="hash-link" href="#and" title="Direct link to heading">‚Äã</a></h4><p>The <code>AND</code> instruction consumes the top two elements of the stack and computes a logical <em>AND</em> of the two elements.</p><p><img src="/opentezos/assets/images/michelson_instruction_and_example-2fd12cc90ac9f9e196e32ebbde1b449f.svg"></p><small class="figure">FIGURE 14: Illustration of the `AND` instruction</small><p>The <code>AND</code> instruction requires boolean elements.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="xor">XOR<a aria-hidden="true" class="hash-link" href="#xor" title="Direct link to heading">‚Äã</a></h4><p>The <code>XOR</code> instruction consumes the top two elements of the stack and computes an exclusive logical <em>OR</em> of the two elements.</p><p><img src="/opentezos/assets/images/michelson_instruction_xor_example-1462803c39d1fea62b796fa579ca0587.svg"></p><small class="figure">FIGURE 15: Illustration of the `XOR` instruction</small><p>The <code>XOR</code> instruction requires boolean elements.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="not">NOT<a aria-hidden="true" class="hash-link" href="#not" title="Direct link to heading">‚Äã</a></h4><p>The <code>NOT</code> instruction consumes a boolean top element of the stack and pushes the logical inverse of the given boolean.  </p><h3 class="anchor anchorWithStickyNavbar_31ik" id="operations-on-numbers">Operations on numbers<a aria-hidden="true" class="hash-link" href="#operations-on-numbers" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="add">ADD<a aria-hidden="true" class="hash-link" href="#add" title="Direct link to heading">‚Äã</a></h4><p>The <code>ADD</code> instruction computes addition on <em>nat</em> and <em>int</em>. It consumes the top two elements of the stack and pushes back the addition of the two elements on top of the stack.</p><p><img src="/opentezos/assets/images/michelson_instruction_add_example-938944ba9bd680b6fc511043a9f61fdd.svg"></p><small class="figure">FIGURE 16: Illustration of the `ADD` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="sub">SUB<a aria-hidden="true" class="hash-link" href="#sub" title="Direct link to heading">‚Äã</a></h4><p>The <code>SUB</code> instruction computes subtractions on <em>nat</em> and <em>int</em>. It consumes the top two elements of the stack and pushes back the difference of the two elements on top of the stack.</p><p>Notice that the subtraction of two natural integers produces an integer  (since the expression <code>2 - 4</code> produces an number smaller than 0).</p><p><img src="/opentezos/assets/images/michelson_instruction_sub_example-4a0e1da09f0dd54089302c43f8dc4f13.svg"></p><small class="figure">FIGURE 17: Illustration of the `SUB` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="mul">MUL<a aria-hidden="true" class="hash-link" href="#mul" title="Direct link to heading">‚Äã</a></h4><p>The <code>MUL</code> instruction computes multiplications on <em>nat</em> and <em>int</em>.</p><p><img src="/opentezos/assets/images/michelson_instruction_mul_example-427e0664e857a85a48e31282eb8daefa.svg"></p><small class="figure">FIGURE 18: Illustration of the `MUL` instruction</small><p>Notice that the multiplication of two natural integers produces a natural integer.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="ediv">EDIV<a aria-hidden="true" class="hash-link" href="#ediv" title="Direct link to heading">‚Äã</a></h4><p>The <code>EDIV</code> instruction computes divisions on <em>nat</em> and <em>mutez</em>.</p><p>The euclidean division computes the quotient and the remainder between two numbers.</p><p>If the divisor is equal to zero, it returns an optional type with the assigned value <em>None</em>. Otherwise, it applies the Euclidean division and returns an optional type containing the result (quotient and remainder). </p><p><img src="/opentezos/assets/images/michelson_instruction_ediv_example-affff443b53a6bd499435337c1ed0b6a.svg"></p><small class="figure">FIGURE 19: Illustration of the `EDIV` instruction</small><h3 class="anchor anchorWithStickyNavbar_31ik" id="operations-on-strings">Operations on strings<a aria-hidden="true" class="hash-link" href="#operations-on-strings" title="Direct link to heading">‚Äã</a></h3><p>Strings are mostly used for naming things without having to rely on external ID databases. They are restricted to the printable subset of 7-bit ASCII, plus some escaped characters (see the section on constants). We can use string constants as is, concatenate or splice them, and also use them as keys.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="concat">CONCAT<a aria-hidden="true" class="hash-link" href="#concat" title="Direct link to heading">‚Äã</a></h4><p>The <code>CONCAT</code> instruction concatenates strings. It consumes the two top elements and produces a string (concatenation of the two top element) that is placed on top of the stack. The <code>CONCAT</code> instruction also works with a list of strings. </p><h4 class="anchor anchorWithStickyNavbar_31ik" id="size">SIZE<a aria-hidden="true" class="hash-link" href="#size" title="Direct link to heading">‚Äã</a></h4><p>The <code>SIZE</code> instruction consumes a string of the top of the stack and pushes the number of characters contained in the string element.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="slice">SLICE<a aria-hidden="true" class="hash-link" href="#slice" title="Direct link to heading">‚Äã</a></h4><p>The <code>SLICE</code> instruction provides a way to retrieve a part of a string.
It expects on top of the stack three elements:</p><ul><li>an <code>offset</code> argument indicating the beginning of the substring </li><li>a <code>length</code> argument indicating the size of the substring</li><li>a <code>string</code> to slice</li></ul><p>It returns an optional string because the given offset may be out of bound.</p><p><img src="/opentezos/assets/images/michelson_instruction_slice_example-e6cd513819ba4cc66ee7f3f0687ae904.svg"></p><small class="figure">FIGURE 20: Illustration of the `SLICE` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="compare-with-strings">COMPARE with strings<a aria-hidden="true" class="hash-link" href="#compare-with-strings" title="Direct link to heading">‚Äã</a></h4><p>The <code>COMPARE</code> instruction allows two strings to be compared. It consumes the top two elements of the stack and pushes an integer to the top. If the first element is lexically greater than the second, then it returns 1. If the first element is lexically equal to the second element, then it returns 0. If the first element is lexically smaller than the second element, then it returns -1.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="control-structures">Control structures<a aria-hidden="true" class="hash-link" href="#control-structures" title="Direct link to heading">‚Äã</a></h3><p>Michelson is a turing-complete language and thus provides basic control flow instructions.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="sequence-">Sequence {}<a aria-hidden="true" class="hash-link" href="#sequence-" title="Direct link to heading">‚Äã</a></h4><p>The Sequence structure is defined by <code>{</code> and <code>}</code> and contains instructions separated by <code>;</code> (semi-colon).</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> instruction1 </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> instruction2 </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> instruction n</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When executing a sequence the interpreter executes each instruction sequentially, one after the other, in the specified order.</p><p>However, this sequence may stop by throwing an exception.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="failwith">FAILWITH<a aria-hidden="true" class="hash-link" href="#failwith" title="Direct link to heading">‚Äã</a></h4><p>The <code>FAILWITH</code> instruction aborts the execution of the Michelson script by throwing an exception.</p><p>The <code>FAILWITH</code> instruction consumes the top element of the stack as argument (usually a string message). The consumed element must be of a pushable type. It is allowed to throw an exception without message by pushing a <code>UNIT</code> value on top of the stack.</p><p>The <code>FAIL</code> keyword has been provided as replacement for <code>UNIT; FAILWITH</code>.</p><p>Actually, the <code>FAIL</code> keyword is not an instruction but a syntactic sugar (i.e. a &quot;shortcut&quot; instruction that combines many of language&#x27;s basic instructions).</p><p>A <code>FAILWITH</code> instruction provides a way to reject a transaction by stopping the execution of related instructions.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="if--">IF {} {}<a aria-hidden="true" class="hash-link" href="#if--" title="Direct link to heading">‚Äã</a></h4><p>The <code>IF</code> instruction allows branches of execution to be created (also called conditional branching).</p><p>The <code>IF</code> instruction takes two sequences as arguments. It expects a boolean at the top element of the stack. It consumes the top element and executes the first given sequence if this boolean-top element is <em>True</em>. Otherwise it executes the second sequence.</p><p>Here is an example of an <code>IF</code> instruction that inverts the position of two elements of the stack if the condition is <em>False</em>, otherwise it throws an exception. Inverting the positions of two elements is done using the <code>SWAP</code> instruction.</p><p><img src="/opentezos/assets/images/michelson_instruction_if_example-e6a11542d1bec6f3086bc2b89fcb25d0.svg"></p><small class="figure">FIGURE 1: Execution of `IF`</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="loop-">LOOP {}<a aria-hidden="true" class="hash-link" href="#loop-" title="Direct link to heading">‚Äã</a></h4><p>The <code>LOOP</code> instruction is a generic loop, meaning it is a repeatable pattern. It applies a sequence of instructions many times until a condition is reached. </p><p>The <code>LOOP</code> instruction makes it possible to iterate on a composite structure (list, set, map, big_map) and apply a process to all elements sequentially.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="loop_left-loop-with-accumulator">LOOP_LEFT (loop with accumulator)<a aria-hidden="true" class="hash-link" href="#loop_left-loop-with-accumulator" title="Direct link to heading">‚Äã</a></h4><p>Like the <code>LOOP</code> instruction, <code>LOOP_LEFT {}</code> is a generic loop that handles an accumulator generally used for aggregating data during a repetitive process. </p><p>The <code>LOOP_LEFT {}</code> takes a sequence of instructions as argument and requires a <code>union</code> (composed of a given data structure and an accumulator) on top of the stack. If the left part of the <code>union</code> is initialized the process is repeated. If the right part is initialized then the process is stopped and the accumulator is returned.</p><p>Two examples (<a href="https://opentezos.com/michelson/examples#example-4--computing-a-sum-with-loop_left" target="_blank" rel="noopener noreferrer">#4</a> and <a href="https://opentezos.com/michelson/examples#example-5--computing-a-factorial-with-loop_left" target="_blank" rel="noopener noreferrer">#5</a>) in the <em>Examples</em> section describe in detail the <code>LOOP_LEFT</code> instruction usage.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="exec">EXEC<a aria-hidden="true" class="hash-link" href="#exec" title="Direct link to heading">‚Äã</a></h4><p>The <code>EXEC</code> instruction executes a function from the stack.</p><p>The <code>EXEC</code> instruction consumes a function and its related input arguments on top of the stack. The <code>EXEC</code> instruction produces the expected function output on the top of the stack.</p><p>Here is an example of a smart contract that defines a function with the <code>LAMBDA</code> instruction and executes the function with the <code>EXEC</code> instruction.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">parameter int </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storage int </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">LAMBDA</span><span class="token plain"> int int </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PUSH</span><span class="token plain"> int </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">EXEC</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Notice that the code of the <code>LAMBDA</code> function just increments a given integer by 1.</p><p>The execution of this smart contract is described in the &quot;example&quot; section.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="apply">APPLY<a aria-hidden="true" class="hash-link" href="#apply" title="Direct link to heading">‚Äã</a></h4><p>The <code>APPLY &#x27;a</code> instruction partially applies a <em>tuplified</em> function from the stack (i.e. arguments are grouped in pairs or nested pairs). It is parameterized by a type <code>&#x27;a</code>. Values that are not both push-able and storable (i.e. values of type <em>operation</em>, <em>contract</em>, and <em>big map</em>) cannot be captured by <em>APPLY</em> (and so cannot appear in argument <code>&#x27;a</code>).</p><p>The instruction produces a new function that is only partially resolved. For example, if a function takes 2 arguments, it is possible to provide one argument and to use the <code>APPLY</code> instruction to produce an equivalent partially-resolved function which takes one argument.</p><p>For example, let&#x27;s consider a <code>lambda</code> function (called <em>additionAB</em>) that takes a pair of <em>nat</em> and returns a <em>nat</em>. It computes the addition of two numbers.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">LAMBDA</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pair nat nat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> nat </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Notice that the function is tuplified.</p><p>The <code>APPLY</code> instruction allows a new <code>lambda</code> function to be formed (called <em>addition2B</em>) which takes a single <em>nat</em> as argument and returns a <em>nat</em>. This function would increment a given <em>nat</em> by two. </p><p>The resulting function <em>addition2B</em> is equivalent to:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">LAMBDA</span><span class="token plain"> nat nat </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PUSH</span><span class="token plain"> nat </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="operations-on-pairs">Operations on pairs<a aria-hidden="true" class="hash-link" href="#operations-on-pairs" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="pair">PAIR<a aria-hidden="true" class="hash-link" href="#pair" title="Direct link to heading">‚Äã</a></h4><p>The <code>PAIR</code> instruction consumes the top two elements of the stack and creates a pair with these two elements.</p><p><img src="/opentezos/assets/images/michelson_instruction_pair_example-01992fc3a497d3da819622acf23421b1.svg"></p><small class="figure">FIGURE 21: Illustration of the `PAIR` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="car">CAR<a aria-hidden="true" class="hash-link" href="#car" title="Direct link to heading">‚Äã</a></h4><p>The <code>CAR</code> instruction consumes the top element of the stack (which must be a <code>PAIR</code>) and pushes back on top of the stack the left part of the pair.</p><p><img src="/opentezos/assets/images/michelson_instruction_car_example-5aab635921f5fc0da71b5dd5ad5b72b9.svg"></p><small class="figure">FIGURE 22: Illustration of the `CAR` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="cdr">CDR<a aria-hidden="true" class="hash-link" href="#cdr" title="Direct link to heading">‚Äã</a></h4><p>The <code>CDR</code> instruction consumes the top element of the stack (which must be a <code>PAIR</code>) and pushes back on top of the stack the right part of the pair.</p><p><img src="/opentezos/assets/images/michelson_instruction_cdr_example-b3a0b33e8bb879111b621a676e0c1bca.svg"></p><small class="figure">FIGURE 23: Illustration of the `CDR` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="compare-on-pairs">COMPARE on pairs<a aria-hidden="true" class="hash-link" href="#compare-on-pairs" title="Direct link to heading">‚Äã</a></h4><p>The <code>COMPARE</code> instruction computes a lexicographic comparison. Like the generic comparison it consumes the top two elements of the stack and returns an integer (-1, 0 ,1). </p><p>The <code>COMPARE</code> instruction executes the comparison on both (left and right) part of a <em>pair</em>. It starts with comparing left parts and if the result is 0 (i.e. left parts are equal) then the comparison is done on the right part of the pair.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="operations-on-sets">Operations on sets<a aria-hidden="true" class="hash-link" href="#operations-on-sets" title="Direct link to heading">‚Äã</a></h3><p>The <code>SET</code> data structure is an ordered list of elements. Therefore a value in a set can appear only once.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="empty_set-elt">EMPTY_SET &#x27;elt<a aria-hidden="true" class="hash-link" href="#empty_set-elt" title="Direct link to heading">‚Äã</a></h4><p>The <code>EMPTY_SET</code> instruction builds a new, empty set for elements of a given type.</p><p>The &#x27;elt type must be comparable (the COMPARE primitive must be defined over it).</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="mem">MEM<a aria-hidden="true" class="hash-link" href="#mem" title="Direct link to heading">‚Äã</a></h4><p>The <code>MEM</code> instruction checks for the presence of an element in a set.</p><p>The <code>MEM</code> instruction returns a boolean on top of the stack.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="update">UPDATE<a aria-hidden="true" class="hash-link" href="#update" title="Direct link to heading">‚Äã</a></h4><p>The <code>UPDATE</code> instruction inserts or removes an element in a set, replacing a previous value.</p><p>It takes the top two elements of the stack:</p><ul><li>an element whose type corresponds to the <em>set</em> type</li><li>a boolean representing the existence of this element in the <em>set</em></li></ul><p>If the boolean argument is <em>False</em> then the element will be removed.</p><p><img src="/opentezos/assets/images/michelson_instruction_updatesetremove_example-4c3a938c8048ccc2eb3839835a6a770d.svg"></p><small class="figure">FIGURE 24: Illustration of the `UPDATE` instruction</small><p>If the boolean argument is <em>True</em> then the element will be inserted.</p><p><img src="/opentezos/assets/images/michelson_instruction_updatesetinsert_example-fb43a4f5d1e08e0d3c9bee5d40e1e89e.svg"></p><small class="figure">FIGURE 25: Illustration of the `UPDATE` instruction</small><p>The following smart contract illustrates the <code>UPDATE</code> instruction usage. This smart contract stores a set of integers and can be invoked by specifying an integer that will be inserted in the set.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">parameter int </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">storage</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">PUSH</span><span class="token plain"> bool </span><span class="token maybe-class-name">True</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">UPDATE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can test the smart contract with the following command:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tezos</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">client run script set_example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tz</span><span class="token plain"> on storage </span><span class="token string" style="color:#e3116c">&#x27;{1;2;3; 9}&#x27;</span><span class="token plain"> and input </span><span class="token string" style="color:#e3116c">&#x27;7&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="iter-body">ITER body<a aria-hidden="true" class="hash-link" href="#iter-body" title="Direct link to heading">‚Äã</a></h4><p>The <code>ITER</code> instruction takes a sequence of instructions (called &quot;body&quot;) as argument.</p><p>The <code>ITER</code> instruction applies a given sequence of instructions to each element of a set. The &quot;body&quot; sequence has access to the stack.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="size-1">SIZE<a aria-hidden="true" class="hash-link" href="#size-1" title="Direct link to heading">‚Äã</a></h4><p>The <code>SIZE</code> instruction consumes a set from the top of the stack and pushes to the top the number of elements contained in the set.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="operations-on-optional-values">Operations on optional values<a aria-hidden="true" class="hash-link" href="#operations-on-optional-values" title="Direct link to heading">‚Äã</a></h3><p>An optional value is a data structure that can hold a value (of a given type). The optional value has two states: it is defined as <code>NONE</code> if no value is assigned and can be defined as <code>SOME</code> if a value has been assigned.</p><p>When defining an optional value, the type of value must be specified.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="some">SOME<a aria-hidden="true" class="hash-link" href="#some" title="Direct link to heading">‚Äã</a></h4><p>The <code>SOME</code> instruction packs a value as an optional value.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="none">NONE<a aria-hidden="true" class="hash-link" href="#none" title="Direct link to heading">‚Äã</a></h4><p>The <code>NONE</code> instruction specifies the absence of value. It requires that the type of value that can be held be specified.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="if_none">IF_NONE<a aria-hidden="true" class="hash-link" href="#if_none" title="Direct link to heading">‚Äã</a></h4><p>The <code>IF_NONE bt bf</code> instruction inspects an optional value.
It requires two sequences of instructions, as with an <code>IF</code> instruction.
It executes the first sequence if the optional value has no value assigned, otherwise it executes the second sequence of instructions (where a value has been assigned with a <code>SOME</code> instruction).</p><p>If the <code>IF_NONE</code> instruction encounters a NONE value it consumes it and then start executing the first sequence.<br>
<!-- -->If the <code>IF_NONE</code> instruction encounters a SOME value it does not consumes it and then start executing the second sequence.</p><p><img src="/opentezos/assets/images/michelson_instruction_ifnone_none_example-f162286deb209c962f0b4220843d3f51.svg"></p><small class="figure">FIGURE 25: Illustration of the `IF_NONE` instruction</small><p><img src="/opentezos/assets/images/michelson_instruction_ifnone_some_example-1583eb394f815c74940d8c5a832517d3.svg"></p><small class="figure">FIGURE 26: Illustration of the `IF_NONE` instruction</small><h3 class="anchor anchorWithStickyNavbar_31ik" id="operations-on-mapsbig_maps">Operations on maps/big_maps<a aria-hidden="true" class="hash-link" href="#operations-on-mapsbig_maps" title="Direct link to heading">‚Äã</a></h3><p>A <code>map</code> is an associative array. It stores many pairs of key-value elements, i.e. it binds a key and a value. Key and value type must be defined when instantiating a new <code>map</code>.</p><p>The <code>map</code> data structure can only contain a limited amount of data. When using big and complex types as values, it is recommended to use the <code>big_map</code> data structure.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="empty_map-key-val-and-empty_big_map-key-val">EMPTY_MAP &#x27;key &#x27;val and EMPTY_BIG_MAP &#x27;key &#x27;val<a aria-hidden="true" class="hash-link" href="#empty_map-key-val-and-empty_big_map-key-val" title="Direct link to heading">‚Äã</a></h4><p>The <code>EMPTY_MAP</code> instruction builds a new empty map. It requires the type definition of the key (<em>&#x27;key</em>) and type definition of the value (<em>&#x27;val</em>).</p><p>The <em>&#x27;key</em> type must be comparable (the COMPARE primitive must be defined over it).</p><p>The <code>EMPTY_BIG_MAP</code> instruction builds a new empty <code>big_map</code> data structure.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="mem-1">MEM<a aria-hidden="true" class="hash-link" href="#mem-1" title="Direct link to heading">‚Äã</a></h4><p>The <code>MEM</code> instruction checks for the presence of a binding for a key in a map.</p><p>It takes a key as argument and returns a boolean on top of the stack.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="update-1">UPDATE<a aria-hidden="true" class="hash-link" href="#update-1" title="Direct link to heading">‚Äã</a></h4><p>The <code>UPDATE</code> instruction adds or removes an element in a map.</p><p>The <code>UPDATE</code> instruction expects a key, an optional value and a map on top of the stack. It consumes the key and the optional value and modifies the map accordingly.</p><p>If the optional value is defined as <code>None</code>, then the element is removed from the map. The following smart contract (map_remove_example.tz) illustrates the <code>UPDATE</code> usage while removing an element from the map.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">parameter string </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">storage</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">map string int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">NONE</span><span class="token plain"> int </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">UPDATE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This smart contract can be tested with the following command:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tezos</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">client run script map_remove_example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tz</span><span class="token plain"> on storage </span><span class="token string" style="color:#e3116c">&#x27;{ Elt &quot;toto&quot; 1 }&#x27;</span><span class="token plain"> and input </span><span class="token string" style="color:#e3116c">&#x27;&quot;toto&quot;&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><img src="/opentezos/assets/images/michelson_instruction_mapremove_example-c398367edc01b4738fcfe4898af9fb64.svg"></p><small class="figure">FIGURE 27: Illustration of the `UPDATE` instruction</small><p>If the optional value is defined as <code>Some</code> then the element is insert into the map. The following smart contract (map_insert_example.tz) illustrates the <code>UPDATE</code> usage while inserting an element into the map.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">parameter string </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">storage</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">map string int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">PUSH</span><span class="token plain"> int </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">SOME</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">UPDATE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This smart contract can be tested with the following command.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tezos</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">client run script map_insert_example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tz</span><span class="token plain"> on storage </span><span class="token string" style="color:#e3116c">&#x27;{ Elt &quot;toto&quot; 1 }&#x27;</span><span class="token plain"> and input </span><span class="token string" style="color:#e3116c">&#x27;&quot;tutu&quot;&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><img src="/opentezos/assets/images/michelson_instruction_mapinsert_example-bf78e54704a2a5bf367f5cbba30d23bf.svg"></p><small class="figure">FIGURE 28: Illustration of the `UPDATE` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="get">GET<a aria-hidden="true" class="hash-link" href="#get" title="Direct link to heading">‚Äã</a></h4><p>The <code>GET</code> instruction allows to access to an element inside a map. It returns an optional value to be checked with an <code>IF_SOME</code> instruction.</p><p>The following smart contract illustrates the usage of <code>GET</code>. The storage of this contract defines a map. This smart contract takes a key as the parameter and inserts a new element in the map if the key does not exist. In this case it assigns value 0 to the given key. Otherwise if the map possesses an element for the given key then it increments its associated value.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">parameter string </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">storage</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">map string int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">GET</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">IF_NONE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PUSH</span><span class="token plain"> int </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SOME</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PUSH</span><span class="token plain"> int </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SOME</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">UPDATE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This smart contract can be simulated with the following commands:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tezos</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">client run script map_example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tz</span><span class="token plain"> on storage </span><span class="token string" style="color:#e3116c">&#x27;{}&#x27;</span><span class="token plain"> and input </span><span class="token string" style="color:#e3116c">&#x27;&quot;toto&quot;&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tezos</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">client run script map_example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tz</span><span class="token plain"> on storage </span><span class="token string" style="color:#e3116c">&#x27;{ Elt &quot;toto&quot; 5 }&#x27;</span><span class="token plain"> and input </span><span class="token string" style="color:#e3116c">&#x27;&quot;toto&quot;&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Notice that <code>{}</code> represents an empty map and <code>{ Elt &quot;toto&quot; 5 }</code> a map containing one element where &quot;toto&quot; is the key and its associated value is 5.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="map-body">MAP body<a aria-hidden="true" class="hash-link" href="#map-body" title="Direct link to heading">‚Äã</a></h4><p>The <code>MAP</code> instruction applies a sequence of instructions to each element of a map. It takes a sequence of instructions as argument (called &quot;body&quot;). This &quot;body&quot; sequence has access to the stack.</p><p>The following smart contract (map_map_example.tz) illustrates the <code>MAP</code> usage. This smart contract stores a <code>map string nat</code> and when invoked it goes through all key-value elements of the map and multiplies by 2 the <code>nat</code> value.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">parameter unit </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">storage</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">map string nat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">MAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PUSH</span><span class="token plain"> nat </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">MUL</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The smart contract can be simulated with the following command.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tezos</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">client run script map_map_example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tz</span><span class="token plain"> on storage </span><span class="token string" style="color:#e3116c">&#x27;{ Elt &quot;toto&quot; 1 ; Elt &quot;tutu&quot; 4 }&#x27;</span><span class="token plain"> and input </span><span class="token maybe-class-name">Unit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="iter-body-1">ITER body<a aria-hidden="true" class="hash-link" href="#iter-body-1" title="Direct link to heading">‚Äã</a></h4><p>The <code>ITER</code> instruction applies a sequence of instructions (called &quot;body&quot;) to each element of a map. The &quot;body&quot; sequence has access to the stack.</p><p>An example (&quot;Max list&quot;) illustrating <code>ITER</code> instruction usage is described in the <em>Examples</em> section. Despite being applied to a list of integers, the <code>ITER</code> instruction works in the same way with a map (except at each iteration a <em>pair</em> key-value is pushed on the stack instead of an integer, as in the example &quot;Max list&quot;).</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="size-2">SIZE<a aria-hidden="true" class="hash-link" href="#size-2" title="Direct link to heading">‚Äã</a></h4><p>The <code>SIZE</code> instruction computes the number of elements inside a map.</p><p>It consumes a map on top of the stack and places the number of elements on top of the stack.</p><p>Notice that the <code>SIZE</code> instruction cannot be applied to <code>big_map</code> type. </p><h3 class="anchor anchorWithStickyNavbar_31ik" id="operations-on-unions">Operations on unions<a aria-hidden="true" class="hash-link" href="#operations-on-unions" title="Direct link to heading">‚Äã</a></h3><p>The <code>union</code> data structure specifies two possible type definitions with logical <em>or</em>. It can be used to create a new type which can handle two different type definitions.</p><p>For example, the following Michelson expression defines the type &quot;int_or_nat&quot; as:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">or int nat</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="left">LEFT<a aria-hidden="true" class="hash-link" href="#left" title="Direct link to heading">‚Äã</a></h4><p>The <code>LEFT p</code> instruction takes the top-element of the stack and produces a <em>union</em>.
The top-element is placed in the right branch of the <code>or</code> structure and the left branch is typed with the given <code>p</code> argument.</p><p>It consumes a type definition on top of the stack and pushes a union where the left part is defined as the consumed type definition.</p><p>Usage of the <code>LEFT</code> instruction is illustrated in the example section.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="right">RIGHT<a aria-hidden="true" class="hash-link" href="#right" title="Direct link to heading">‚Äã</a></h4><p>The <code>RIGHT p</code> instruction takes the top-element of the stack and produces a <em>union</em>.
The top-element is placed in the left branch of the <code>or</code> structure and the right branch is typed with the given <code>p</code> argument.</p><p>It consumes a type definition on top of the stack and pushes a union where the right part is defined as the consumed type definition.</p><p>Usage of the <code>RIGHT</code> instruction is illustrated in the example section.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="if_left">IF_LEFT<a aria-hidden="true" class="hash-link" href="#if_left" title="Direct link to heading">‚Äã</a></h4><p>The <code>IF_LEFT</code> instruction inspects a value of <em>union</em>. It requires two sequences of instructions (bt bf), like with an <code>IF</code> instruction. </p><p>The <code>IF_LEFT bt bf</code> executes the &quot;bt&quot; sequence if the left part of a <em>union</em> has been given, otherwise it will execute the &quot;bf&quot; sequence.</p><p>The instruction consumes a Michelson expression on top of the stack which specifies which part of the <em>union</em> has been defined.</p><p>The following smart contract (union_example.tz) illustrates the <code>IF_LEFT</code> usage. Notice that the parameter is a <em>union</em> <code>(or string int)</code> and the storage is an integer. This smart contract increments the storage if an integer is passed as parameter (i.e. if the smart contract is invoked with an integer) and does nothing if a string is given.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">parameter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">or string int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storage int </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">IF_LEFT</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DROP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To illustrate the invocation of the smart contract, we will break down its execution.</p><p>The following command simulates the execution of the smart contract when called with an integer.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tezos</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">client run script union_example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tz</span><span class="token plain"> on storage </span><span class="token string" style="color:#e3116c">&#x27;5&#x27;</span><span class="token plain"> and input </span><span class="token string" style="color:#e3116c">&#x27;Right 1&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><img src="/opentezos/assets/images/michelson_instruction_ifleft_right_example-24b5d95ac17997958bdf0411855b54c0.svg"></p><small class="figure">FIGURE 30: Illustration of the `IF_LEFT` instruction</small><p>The following command simulates the execution of the smart contract when called with a string.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tezos</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">client run script union_example</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tz</span><span class="token plain"> on storage </span><span class="token string" style="color:#e3116c">&#x27;5&#x27;</span><span class="token plain"> and input </span><span class="token string" style="color:#e3116c">&#x27;Left &quot;Hello&quot;&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><img src="/opentezos/assets/images/michelson_instruction_ifleft_left_example-4be764b370901ac4c41804b7c62bee2f.svg"></p><small class="figure">FIGURE 31: Illustration of the `IF_LEFT` instruction</small><h3 class="anchor anchorWithStickyNavbar_31ik" id="operations-on-lists">Operations on lists<a aria-hidden="true" class="hash-link" href="#operations-on-lists" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="cons">CONS<a aria-hidden="true" class="hash-link" href="#cons" title="Direct link to heading">‚Äã</a></h4><p>The <code>CONS</code> instruction adds an element to a list (at the beginning of the list).</p><p><img src="/opentezos/assets/images/michelson_instruction_cons_example-72004d345be8eef54baf5d4a6ee62904.svg"></p><small class="figure">FIGURE 32: Illustration of the `CONS` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="nil">NIL<a aria-hidden="true" class="hash-link" href="#nil" title="Direct link to heading">‚Äã</a></h4><p>The <code>NIL &#x27;a</code> instruction specifies an empty list. The type of list elements must be specified. </p><p><img src="/opentezos/assets/images/michelson_instruction_nillist_example-e14ad579e2909d07424acb3297cef796.svg"></p><small class="figure">FIGURE 33: Illustration of the `NIL` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="if_cons">IF_CONS<a aria-hidden="true" class="hash-link" href="#if_cons" title="Direct link to heading">‚Äã</a></h4><p>The <code>IF_CONS bt bf</code> instruction inspects a list. It requires two sequences of instructions (bt anf bf), as with the <code>IF</code> instruction.</p><p>This instruction removes the first element of the list, pushes it on top of the stack and executes the first sequence of instructions (<code>bt</code>). If the list is empty, then the second list of instructions is executed (<code>bf</code>).</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="map-body-1">MAP body<a aria-hidden="true" class="hash-link" href="#map-body-1" title="Direct link to heading">‚Äã</a></h4><p>The <code>MAP</code> instruction applies a sequence of instructions to each element of a list. The <code>MAP</code> instruction requires a sequence of instructions (i.e. &quot;body&quot;) which has access to the stack.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="size-3">SIZE<a aria-hidden="true" class="hash-link" href="#size-3" title="Direct link to heading">‚Äã</a></h4><p>The <code>SIZE</code> instruction computes the number of elements in the list.
It consumes a list on top of the stack and pushes the number of elements of the list back on top.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="iter-body-2">ITER body<a aria-hidden="true" class="hash-link" href="#iter-body-2" title="Direct link to heading">‚Äã</a></h4><p>The <code>ITER</code> instruction applies a sequence of instructions to each element of a list. The <code>ITER</code> instruction requires a sequence of instructions (called &quot;body&quot;) which has access to the stack.</p><p>Notice that the Michelson language defines the <code>ITER</code> instruction as a recursive call.</p><p>An example is described in the <em>Examples</em> section.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="operations-on-timestamps">Operations on timestamps<a aria-hidden="true" class="hash-link" href="#operations-on-timestamps" title="Direct link to heading">‚Äã</a></h3><p>Timestamps can be obtained by the <code>NOW</code> operation, or retrieved from script parameters or globals.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="now">NOW<a aria-hidden="true" class="hash-link" href="#now" title="Direct link to heading">‚Äã</a></h4><p>The <code>NOW</code> instruction pushes the timestamp of the block whose validation triggered this execution. This timestamp does not change during the execution of the contract.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="add-1">ADD<a aria-hidden="true" class="hash-link" href="#add-1" title="Direct link to heading">‚Äã</a></h4><p>The <code>ADD</code> instruction increments a timestamp of the given number of seconds. The number of seconds must be expressed as an <code>int</code> and not as a <code>nat</code>.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="sub-1">SUB<a aria-hidden="true" class="hash-link" href="#sub-1" title="Direct link to heading">‚Äã</a></h4><p>The <code>SUB</code> instruction subtracts a number of seconds from a timestamp. It can also be used to subtract two timestamps.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="compare-1">COMPARE<a aria-hidden="true" class="hash-link" href="#compare-1" title="Direct link to heading">‚Äã</a></h4><p>The <code>COMPARE</code> computes timestamp comparison. It returns an integer, as with the <code>COMPARE</code> instruction for an integer.</p><p>It returns 1 if the first timestamp is bigger than the second timestamp, 0 if both timestamps are equal, and -1 otherwise. </p><h3 class="anchor anchorWithStickyNavbar_31ik" id="operations-on-mutez">Operations on mutez<a aria-hidden="true" class="hash-link" href="#operations-on-mutez" title="Direct link to heading">‚Äã</a></h3><p>Mutez (micro-Tez) are internally represented by a 64-bit, signed integer. There are restrictions to prevent creating a negative amount of mutez. Operations are limited in order to prevent overflow and to avoid mixing with other numerical types by mistake. They are also mandatorily checked for under/overflows.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="add-2">ADD<a aria-hidden="true" class="hash-link" href="#add-2" title="Direct link to heading">‚Äã</a></h4><p>The <code>ADD</code> instruction computes additions on mutez. It consumes two <em>mutez</em> elements on top of the stack and pushes back the addition of the two quantities on top of the stack.</p><p>This operation may fail in case of overflow.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="sub-2">SUB<a aria-hidden="true" class="hash-link" href="#sub-2" title="Direct link to heading">‚Äã</a></h4><p>The <code>SUB</code> instruction computes subtractions on mutez. It consumes two <em>mutez</em> elements on top of the stack and pushes back the difference of the two quantities on top of the stack.</p><p>A <em>mutez</em> value cannot be negative so this substration may fail if the first value is smaller than the second one.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="mul-1">MUL<a aria-hidden="true" class="hash-link" href="#mul-1" title="Direct link to heading">‚Äã</a></h4><p>The <code>MUL</code> instruction computes multiplications on mutez. It consumes a <em>mutez</em> and a <em>nat</em> elements on top of the stack and pushes back the product of the two quantities on top of the stack.</p><p>The multiplication allows mutez to be multiplied with natural integers.</p><p>Multiplication of 2 <code>mutez</code> operands is not allowed. </p><h4 class="anchor anchorWithStickyNavbar_31ik" id="ediv-1">EDIV<a aria-hidden="true" class="hash-link" href="#ediv-1" title="Direct link to heading">‚Äã</a></h4><p>The <code>EDIV</code> instruction computes the euclidean division on mutez. It consumes a <em>mutez</em> and a <em>nat</em> elements on top of the stack and pushes back a <code>option pair</code> with the quotient and the reminder (of the two elements) on top of the stack.</p><p>The euclidean division allows a mutez to be divided by a natural integer.</p><p>It is also possible to divide 2 mutez, in this case it returns a <code>nat</code> as a quotient and a mutez as the rest of the euclidean division.</p><p>If the divisor is zero then the division is not allowed. In this case, the <code>EDIV</code> instruction produces a <code>NONE</code> on top of the stack. This is why the <code>EDIV</code> instruction returns an <code>option</code> value (i.e. <code>option pair</code> with the quotient and the reminder).</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="compare-2">COMPARE<a aria-hidden="true" class="hash-link" href="#compare-2" title="Direct link to heading">‚Äã</a></h4><p>The <code>COMPARE</code> instruction compares two mutez and returns an integer on top of the stack. It returns 0 if both elements are equal, 1 if the first element is bigger than the second, and -1 otherwise. </p><h3 class="anchor anchorWithStickyNavbar_31ik" id="operations-on-contracts">Operations on contracts<a aria-hidden="true" class="hash-link" href="#operations-on-contracts" title="Direct link to heading">‚Äã</a></h3><p>This section describes instructions specific to smart contracts and interactions between contracts. It includes key features such as emitting transactions and invoking a contract, setting delegations, and even creating contracts on the fly.  </p><h4 class="anchor anchorWithStickyNavbar_31ik" id="contract">CONTRACT<a aria-hidden="true" class="hash-link" href="#contract" title="Direct link to heading">‚Äã</a></h4><p>The <code>CONTRACT &#x27;p</code> instruction casts the address to the given contract type if possible.
It consumes an <code>address</code> to the top element of the stack and returns a contract option which corresponds to the given parameter type.</p><p>The parameter is <code>unit</code> in case of an implicit account.</p><p>The <code>CONTRACT &#x27;p</code> instruction considers the default entrypoint if it exists, otherwise the full parameter is returned. </p><h4 class="anchor anchorWithStickyNavbar_31ik" id="transfer_tokens">TRANSFER_TOKENS<a aria-hidden="true" class="hash-link" href="#transfer_tokens" title="Direct link to heading">‚Äã</a></h4><p>The <code>TRANSFER_TOKENS</code> instruction forges a transaction. In Michelson, the <code>operation</code> type represents a transaction.
Forging a transaction requires the following to be specified: </p><ul><li>the <em>parameter</em> (i.e. the entrypoint expected by the targeted contract)</li><li>a <em>quantity of mutez</em> transferred by this transaction</li><li>a <em>recipient contract</em> representing the target of the transaction (i.e. to which contract this transaction will be sent)</li></ul><p>The parameter must be consistent with the one expected by the contract.
If the transaction is sent to an implicit account (i.e. the address of an account) then the parameter must be set to <code>unit</code>.</p><p>The <code>TRANSFER_TOKENS</code> instruction consumes the three top elements of the stack and outputs a transaction on top of the stack.</p><p>As seen in previous sections, the invocation of a Tezos smart contract produces a list of operations and a new storage state. In a smart contract, when using a <code>TRANSFER_TOKENS</code> instruction to forge a transaction the produced transaction must be included in the returned list of operations in order to be taken into account.</p><p>To illustrate the usage of the <code>TRANSFER_TOKENS</code> instruction, we will consider a simple &quot;Counter&quot; smart contract that can increment or decrement a value. We will create a second smart contract, &quot;CounterCaller&quot;, which forges a transaction and sends it to the &quot;Counter&quot; smart contract using the <code>TRANSFER_TOKENS</code> instruction.</p><p>The following smart contract demonstrates the implementation of the &quot;Counter&quot; smart contract.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">parameter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">or</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int </span><span class="token operator" style="color:#393A34">%</span><span class="token plain">decrement</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int </span><span class="token operator" style="color:#393A34">%</span><span class="token plain">increment</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storage int </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">IF_LEFT</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SUB</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ADD</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The following smart contract demonstrates the implementation of the &quot;CounterCaller&quot; smart contract.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">parameter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">or int int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storage address</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">CONTRACT</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">or int int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">IF_NONE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">DROP</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NIL</span><span class="token plain"> operation </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">PUSH</span><span class="token plain"> mutez </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     </span><span class="token constant" style="color:#36acaa">TRANSFER_TOKENS</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">NIL</span><span class="token plain"> operation</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     </span><span class="token constant" style="color:#36acaa">CONS</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now, let&#x27;s break down the execution of the &quot;CounterCaller&quot; smart contract:</p><p>The following command simulates the invocation of the smart contract.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tezos</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">client run script countercaller</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tz</span><span class="token plain"> on storage </span><span class="token string" style="color:#e3116c">&#x27;&quot;KT1HUbVyf62ZAp7BRqwQaDueb6kgb7Q86cc3&quot;&#x27;</span><span class="token plain"> and input </span><span class="token string" style="color:#e3116c">&#x27;Left 3&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><img src="/opentezos/assets/images/michelson_example_transfertoken_execution-1e728baa011cb9db29a3da35c5063b08.svg"></p><small class="figure">FIGURE 34: Illustration of the `TRANSFER_TOKENS` instruction</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="set_delegate">SET_DELEGATE<a aria-hidden="true" class="hash-link" href="#set_delegate" title="Direct link to heading">‚Äã</a></h4><p>The <code>SET_DELEGATE</code> sets or withdraws the contract&#x27;s delegation. It consumes an <em>option key_hash</em> specifying the delegate and returns a transaction (operation) on top of the stack.</p><p>Using this instruction is the only way to modify the delegation of a smart contract. If the top element is <em>None</em>, then the delegation of the current contract is withdrawn. If the top element is <em>Some kh</em>, where <em>kh</em> is the key hash of a registered delegate (that is not the current delegate of the contract), then this operation sets the delegate of the contract to this registered delegate. The operation fails if <em>kh</em> is the current delegate of the contract or if <em>kh</em> is not a registered delegate.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="balance">BALANCE<a aria-hidden="true" class="hash-link" href="#balance" title="Direct link to heading">‚Äã</a></h4><p>The <code>BALANCE</code> instruction pushes the current amount of mutez held by the executing contract to the stack, including any mutez added by the calling transaction.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="create_contract">CREATE_CONTRACT<a aria-hidden="true" class="hash-link" href="#create_contract" title="Direct link to heading">‚Äã</a></h4><p>The <code>CREATE_CONTRACT</code> instruction forges a new contract. It consumes the top three elements of the stack and pushes back a <em>transaction</em> (responsible for creating the contract) and the <em>address</em> of the newly created contract.</p><p>The <code>CREATE_CONTRACT</code> instruction expects as argument the smart contract definition as a literal <code>{ storage &#x27;g ; parameter &#x27;p ; code ... }</code>, including the storage definition, parameter definition and the code of the smart contract.</p><p>The <code>CREATE_CONTRACT</code> instruction expects three elements on top of the stack (these elements represent arguments for deploying a contract):</p><ul><li>the initial storage value for the new contract.</li><li>an optional <code>key_hash</code> value representing the delegate</li><li>a quantity of mutez transferred to the new contract</li></ul><p>Accessing the newly created contract (via a <code>CONTRACT &#x27;p</code> instruction) will fail until it is actually originated.</p><p>For example, here is an implementation of a &quot;Factory&quot; contract that create and deploys a &quot;Counter&quot; contract (as seen previsouly).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">parameter unit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storage unit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code { DROP;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       PUSH int 9;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       PUSH mutez 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       NONE key_hash;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       CREATE_CONTRACT { parameter (or (int %decrement) (int %increment)) ; storage int ; code { DUP ; CDR ; SWAP ; CAR ; IF_LEFT { SWAP ; SUB } { ADD } ; NIL operation ; PAIR } };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       DIP { NIL operation };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       CONS;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       DIP { DROP; UNIT };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       PAIR }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This smart contract can be simulated with the CLI command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">tezos-client run script factory.tz on storage &#x27;Unit&#x27; and input &#x27;Unit&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="built-ins">Built-ins<a aria-hidden="true" class="hash-link" href="#built-ins" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="address">ADDRESS<a aria-hidden="true" class="hash-link" href="#address" title="Direct link to heading">‚Äã</a></h4><p>The <code>ADDRESS</code> instruction casts the contract to its address. It consumes a contract on top of the stack and pushes back the address of the contract.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="source">SOURCE<a aria-hidden="true" class="hash-link" href="#source" title="Direct link to heading">‚Äã</a></h4><p>The <code>SOURCE</code> instruction pushes the address of the contract that initiated the current transaction, i.e. the contract that paid the fees and storage cost, and whose manager signed the operation that was sent on the blockchain. Note that since the TRANSFER_TOKENS instructions can be chained, <code>SOURCE</code> and <code>SENDER</code> are not necessarily the same.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="sender">SENDER<a aria-hidden="true" class="hash-link" href="#sender" title="Direct link to heading">‚Äã</a></h4><p>The <code>SENDER</code> instruction pushes the address of the contract that initiated the current internal transaction. It may be the <code>SOURCE</code>, but may also be different if the source sent an order to an intermediate smart contract, which then called the current contract.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="self">SELF<a aria-hidden="true" class="hash-link" href="#self" title="Direct link to heading">‚Äã</a></h4><p>The <code>SELF</code> instruction pushes the default entrypoint of a contract on top of the stack. This default entrypoint specifies the expected parameter type. </p><p>The <code>SELF &#x27;p</code> instruction allows to take a entrypoint name &#x27;p as argument. In this case, it pushed the specified entrypoint on top of the stack. </p><h4 class="anchor anchorWithStickyNavbar_31ik" id="amount">AMOUNT<a aria-hidden="true" class="hash-link" href="#amount" title="Direct link to heading">‚Äã</a></h4><p>The <code>AMOUNT</code> instruction pushes the amount of mutez of the current transaction on top of the stack.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="implicit_account">IMPLICIT_ACCOUNT<a aria-hidden="true" class="hash-link" href="#implicit_account" title="Direct link to heading">‚Äã</a></h4><p>The <code>IMPLICIT_ACCOUNT</code> instruction returns a default contract with the given public/private key pair. Any funds deposited in this contract can immediately be spent by the holder of the private key. This contract cannot execute Michelson code and will always exist on the blockchain.</p><p>The instruction pops a <em>key_hash</em> from the top of the stack and pushes a <code>contract unit</code>.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="chain_id">CHAIN_ID<a aria-hidden="true" class="hash-link" href="#chain_id" title="Direct link to heading">‚Äã</a></h4><p>The <code>CHAIN_ID</code> instruction pushes the chain identifier on top of the stack.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="operations-on-bytes">Operations on bytes<a aria-hidden="true" class="hash-link" href="#operations-on-bytes" title="Direct link to heading">‚Äã</a></h3><p>Bytes are used for serializing data in order to check signatures and to compute hashes on them. They can also be used to incorporate data from the untyped outside world.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="pack">PACK<a aria-hidden="true" class="hash-link" href="#pack" title="Direct link to heading">‚Äã</a></h4><p>The <code>PACK</code> instruction serializes a piece of data to its optimized binary representation.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="unpack">UNPACK<a aria-hidden="true" class="hash-link" href="#unpack" title="Direct link to heading">‚Äã</a></h4><p>The <code>UNPACK</code> instruction de-serializes a piece of data, if valid. It returns an <em>option</em> initialized to <em>None</em> if the de-serialization is invalid, or an <em>option</em> initialized to <em>Some</em> if valid.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="concat-1">CONCAT<a aria-hidden="true" class="hash-link" href="#concat-1" title="Direct link to heading">‚Äã</a></h4><p>The <code>CONCAT</code> instruction concatenates two byte sequences. It can also be applied to a list of byte sequences. It consumes a list of byte sequences and pushes the concatenation of all sequences (in the respective order). </p><h4 class="anchor anchorWithStickyNavbar_31ik" id="size-4">SIZE<a aria-hidden="true" class="hash-link" href="#size-4" title="Direct link to heading">‚Äã</a></h4><p>The <code>SIZE</code> instruction computes the size of a sequence of bytes. It consumes a byte sequence and pushes the number of bytes of this sequence.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="slice-1">SLICE<a aria-hidden="true" class="hash-link" href="#slice-1" title="Direct link to heading">‚Äã</a></h4><p>The <code>SLICE</code> instruction provides a way to retrieve a part of a byte sequence.
It expects the following elements on top of the stack:</p><ul><li>an <code>offset</code>, indicating the beginning of the byte sequence </li><li>a <code>length</code>, indicating the size of the sub-sequence</li><li>a <code>byte sequence</code> to slice</li></ul><p>It returns an optional byte sequence because the given offset and length may be out of bound.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="compare-3">COMPARE<a aria-hidden="true" class="hash-link" href="#compare-3" title="Direct link to heading">‚Äã</a></h4><p>The <code>COMPARE</code> instruction computes a lexicographic comparison. As with other <code>COMPARE</code> instructions, it returns 1 if the first sequence is bigger than the second sequence, 0 if both byte sequences are equal, or -1 otherwise.</p><p>The <code>COMPARE</code> instruction can be used only on comparable types.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="crypto-primitives">Crypto primitives<a aria-hidden="true" class="hash-link" href="#crypto-primitives" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="hash_key">HASH_KEY<a aria-hidden="true" class="hash-link" href="#hash_key" title="Direct link to heading">‚Äã</a></h4><p>The <code>HASH_KEY</code> instruction computes the <em>b58check</em> of a public key.</p><p>It consumes a key and pushes back a <em>key_hash</em>.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="blake2b">BLAKE2B<a aria-hidden="true" class="hash-link" href="#blake2b" title="Direct link to heading">‚Äã</a></h4><p>The <code>BLAKE2B</code> instruction computes a cryptographic hash of the value contents using the <em>Blake2b-256</em> cryptographic hash function.</p><p>It consumes a byte sequence and pushes back the computed <em>Blake2b-256</em> hash of this byte sequence.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="sha256">SHA256<a aria-hidden="true" class="hash-link" href="#sha256" title="Direct link to heading">‚Äã</a></h4><p>The <code>SHA256</code> instruction computes a cryptographic hash of the value contents using the <em>Sha256</em> cryptographic hash function.</p><p>It consumes a byte sequence and pushes back the computed <em>Sha256</em> of this byte sequence.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="sha512">SHA512<a aria-hidden="true" class="hash-link" href="#sha512" title="Direct link to heading">‚Äã</a></h4><p>The <code>SHA512</code> instruction computes a cryptographic hash of the value contents using the <em>Sha512</em> cryptographic hash function.</p><p>It consumes a byte sequence and pushes back the computed <em>Sha512</em> of this byte sequence.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="check_signature">CHECK_SIGNATURE<a aria-hidden="true" class="hash-link" href="#check_signature" title="Direct link to heading">‚Äã</a></h4><p>The <code>CHECK_SIGNATURE</code> instruction checks that a sequence of bytes has been signed with a given key.</p><p>It consumes the top three elements of the stack (a byte sequence, a key and a signature) and pushes a boolean. </p><h4 class="anchor anchorWithStickyNavbar_31ik" id="compare-4">COMPARE<a aria-hidden="true" class="hash-link" href="#compare-4" title="Direct link to heading">‚Äã</a></h4><p>The <code>COMPARE</code> instruction compares values of type <code>key_hash</code>. </p><p>As for other <code>COMPARE</code> instructions, it returns 1 if the first <em>key_hash</em> is bigger than than the second key_hash, 0 if the both <em>key_hash</em> values are equal, and -1 otherwise.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="macros-and-syntactic-sugar">Macros and syntactic sugar<a aria-hidden="true" class="hash-link" href="#macros-and-syntactic-sugar" title="Direct link to heading">‚Äã</a></h3><p>Since Michelson is a low-level language, there are some basic combinations of instructions that are regularly used. In order to ease the implementation and reduce the number of instructions of a smart contract, some macros and syntactic sugars have been introduced.</p><p>Syntactic sugar exists for merging the <code>COMPARE</code> instruction with comparison combinators, and also for branching.</p><p>Syntactic sugar exists for merging the <code>ASSERT</code> instruction with specific data types, and also for branching.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="cmpeqneqltgtlege-macro">CMP{EQ|NEQ|LT|GT|LE|GE} macro<a aria-hidden="true" class="hash-link" href="#cmpeqneqltgtlege-macro" title="Direct link to heading">‚Äã</a></h4><p>This macro combines a <code>COMPARE</code> instruction with a basic comparison.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">CMP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">COMPARE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="ifeqneqltgtlege-bt-bf-macro">IF{EQ|NEQ|LT|GT|LE|GE} bt bf macro<a aria-hidden="true" class="hash-link" href="#ifeqneqltgtlege-bt-bf-macro" title="Direct link to heading">‚Äã</a></h4><p>This macro combines a basic comparison with an <code>IF</code> instruction. As with an <code>IF</code> instruction, it requires two sequences of instructions (<em>bt</em> and <em>bf</em>).</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">IF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> bt bf </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IF</span><span class="token plain"> bt bf </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="ifcmpeqneqltgtlege-bt-bf-macro">IFCMP{EQ|NEQ|LT|GT|LE|GE} bt bf macro<a aria-hidden="true" class="hash-link" href="#ifcmpeqneqltgtlege-bt-bf-macro" title="Direct link to heading">‚Äã</a></h4><p>This macro combines a <code>COMPARE</code> instruction with a basic comparison and an <code>IF</code> instruction. As with an <code>IF</code> instruction, it requires two sequences of instructions (<em>bt</em> and <em>bf</em>).</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">IFCMP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">COMPARE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IF</span><span class="token plain"> bt bf </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="assert-macro">ASSERT macro<a aria-hidden="true" class="hash-link" href="#assert-macro" title="Direct link to heading">‚Äã</a></h4><p>The <code>ASSERT</code> macro combines an <code>IF</code> instruction and a <code>FAIL</code> instruction.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token parameter">ASSERT</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">IF</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">FAIL</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Notice that the first sequence of instructions is empty, meaning that it either fails or does nothing.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="assert_eqneqltlegtge-macro">ASSERT_{EQ|NEQ|LT|LE|GT|GE} macro<a aria-hidden="true" class="hash-link" href="#assert_eqneqltlegtge-macro" title="Direct link to heading">‚Äã</a></h4><p>The <code>ASSERT</code> macro combines an <code>ASSERT</code> macro with a basic comparison.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">ASSERT_</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">\op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">IF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">\op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">FAIL</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="assert_cmpeqneqltlegtge-macro">ASSERT_CMP{EQ|NEQ|LT|LE|GT|GE} macro<a aria-hidden="true" class="hash-link" href="#assert_cmpeqneqltlegtge-macro" title="Direct link to heading">‚Äã</a></h4><p>This macro combines an <code>IFCMP</code> macro with the <code>ASSERT</code> macro.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">ASSERT_CMP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">\op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">IFCMP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">\op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">FAIL</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="assert_none-macro">ASSERT_NONE macro<a aria-hidden="true" class="hash-link" href="#assert_none-macro" title="Direct link to heading">‚Äã</a></h4><p>The <code>ASSERT_NONE</code> macro combines an <code>IF_NONE</code> macro with the <code>ASSERT</code> macro.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token parameter">ASSERT_NONE</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">IF_NONE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">FAIL</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="assert_some-macro">ASSERT_SOME macro<a aria-hidden="true" class="hash-link" href="#assert_some-macro" title="Direct link to heading">‚Äã</a></h4><p>The <code>ASSERT_SOME</code> macro combines an <code>IF_NONE</code> macro with the <code>ASSERT</code> macro.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">ASSERT_SOME</span><span class="token plain"> @</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">IF_NONE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">FAIL</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">RENAME</span><span class="token plain"> @x</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Notice that this macro uses the <code>IF_NONE</code> instruction and not the <code>IF_SOME</code> instruction.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="assert_left-macro">ASSERT_LEFT macro<a aria-hidden="true" class="hash-link" href="#assert_left-macro" title="Direct link to heading">‚Äã</a></h4><p>The <code>ASSERT_LEFT</code> macro combines an <code>IF_LEFT</code> instruction with the <code>ASSERT</code> macro.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">ASSERT_LEFT</span><span class="token plain"> @</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">IF_LEFT</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">RENAME</span><span class="token plain"> @x</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">FAIL</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="assert_right-macro">ASSERT_RIGHT macro<a aria-hidden="true" class="hash-link" href="#assert_right-macro" title="Direct link to heading">‚Äã</a></h4><p>The <code>ASSERT_RIGHT</code> macro combines an <code>IF_LEFT</code> instruction with the <code>ASSERT</code> macro. Notice that instruction sequences are inverted compared to the <code>ASSERT_LEFT</code> macro.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">ASSERT_RIGHT</span><span class="token plain"> @</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">IF_LEFT</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">FAIL</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">RENAME</span><span class="token plain"> @x</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="dup-n-macro">DUP n macro<a aria-hidden="true" class="hash-link" href="#dup-n-macro" title="Direct link to heading">‚Äã</a></h4><p>These macros are simply more syntactically convenient for various common operations.</p><p>The <code>DUP n</code> macro is a syntactic sugar for duplicating the n-th element of the stack.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">DUP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">n</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">DUP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIG</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="nested-pair-macro">Nested PAIR macro<a aria-hidden="true" class="hash-link" href="#nested-pair-macro" title="Direct link to heading">‚Äã</a></h4><p>Data structures may become complex in case of nested pairs. The
<code>P(\left=A|P(\left)(\right))(\right=I|P(\left)(\right))R</code> macro is a syntactic sugar for building nested pairs.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">PA</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">P</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">IR</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">P</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token parameter">R</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A good way to quickly figure out which macro to use is to mentally parse the macro as <em>P</em> for the pair constructor, <em>A</em> for the left leaf and <em>I</em> for the right leaf. The macro takes as many elements from the stack as there are leaves and constructs a nested pair with the shape given by its name.</p><p>Take the macro <em>PAPPAIIR</em> for instance:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">P</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">A</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">P</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">P</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">A</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">I</span><span class="token plain">    </span><span class="token constant" style="color:#36acaa">I</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> r </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> r </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A typing rule can be inferred:</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">PAPPAIIR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;a : &#x27;</span><span class="token plain">b </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;c : &#x27;</span><span class="token plain">d </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;S  -&gt;  (pair &#x27;</span><span class="token function" style="color:#d73a49">a</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">pair</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pair </span><span class="token string" style="color:#e3116c">&#x27;b &#x27;</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> &#x27;d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="nested-unpair-macro">Nested UNPAIR macro<a aria-hidden="true" class="hash-link" href="#nested-unpair-macro" title="Direct link to heading">‚Äã</a></h4><p>Data structures may become complex in case of nested pairs. The <code>UNP(\left=A|P(\left)(\right))(\right=I|P(\left)(\right))R</code> is a syntactic sugar for destructing nested pairs. These macros follow the same convention as the previous one.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">UNPAIR</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">UNPA</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UNPAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">UN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">UNP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">IR</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UNPAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">UNP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token parameter">R</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UNPAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">UN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="cadr-macro">C<!-- -->[AD]<!-- -->+R macro<a aria-hidden="true" class="hash-link" href="#cadr-macro" title="Direct link to heading">‚Äã</a></h4><p>The <code>C[AD]+R</code> macro is a syntactic sugar for accessing fields in nested pairs.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">CA</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\rest</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">AD</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">+</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">C</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\rest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">CD</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\rest</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">AD</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">+</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">C</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\rest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For example, in order to access the &quot;sub&quot; part of the above nested pair, the macro <code>CADR</code> can be used, which is equivalent to <code>{ CAR; CDR }</code>.</p><p><img src="/opentezos/assets/images/michelson_macro_C[AD]+R_example-406d9ded47e46d42e62de8fc60e22d18.svg"></p><small class="figure">FIGURE 35: Illustration of the C[AD]+R macro</small><h4 class="anchor anchorWithStickyNavbar_31ik" id="if_some-macro">IF_SOME macro<a aria-hidden="true" class="hash-link" href="#if_some-macro" title="Direct link to heading">‚Äã</a></h4><p>The <code>IF_SOME bt bf</code> macro inspects an <em>option</em> value, like the <code>IF_NONE</code> instruction with inverted sequences of instruction.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">IF_SOME</span><span class="token plain"> bt bf </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">IF_NONE</span><span class="token plain"> bf bt </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="if_right-macro">IF_RIGHT macro<a aria-hidden="true" class="hash-link" href="#if_right-macro" title="Direct link to heading">‚Äã</a></h4><p>The <code>IF_RIGHT bt bf</code> macro inspects an <em>option</em> value, like the <code>IF_LEFT</code> with inverted sequences of instruction.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">IF_RIGHT</span><span class="token plain"> bt bf </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">IF_LEFT</span><span class="token plain"> bf bt </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="set_cadr-macro">SET_C{A|D}R macro<a aria-hidden="true" class="hash-link" href="#set_cadr-macro" title="Direct link to heading">‚Äã</a></h4><p>The <code>SET_CAR</code> sets the left field of a pair. It combines the <code>CDR</code>, <code>SWAP</code> and <code>PAIR</code> instructions.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token parameter">SET_CAR</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PAIR</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>SET_CDR</code> sets the right field of a pair. It combines the <code>CAR</code> and <code>PAIR</code> instructions.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token parameter">SET_CDR</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PAIR</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>SET_C[AD]+R</code> macro is a syntactic sugar for setting fields in nested pairs.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">SET_CA</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\rest</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">AD</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">+</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">   </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SET_C</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\rest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">SET_CD</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\rest</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">AD</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">+</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">   </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SET_C</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\rest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="map_cadr-macro">MAP_C{A|D}R macro<a aria-hidden="true" class="hash-link" href="#map_cadr-macro" title="Direct link to heading">‚Äã</a></h4><p>The <code>MAP_CAR code</code> macro transforms the left field of a pair. It applies the &quot;code&quot; sequence on the left field of a pair.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">MAP_CAR</span><span class="token plain"> </span><span class="token parameter">code</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> code </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PAIR</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>MAP_CDR code</code> macro transforms the right field of a pair. It applies the &quot;code&quot; sequence on the right field of a pair.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">MAP_CDR</span><span class="token plain"> </span><span class="token parameter">code</span><span class="token plain">  </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain">  </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> code </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PAIR</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>MAP_C[AD]+R code</code> is a syntactic sugar for transforming fields in nested pairs.</p><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">MAP_CA</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\rest</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">AD</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">+</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> code </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">   </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">MAP_C</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\rest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> code </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SWAP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">MAP_CD</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\rest</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">AD</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">+</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> code </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token parameter">S</span><span class="token plain">   </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DUP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DIP</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CDR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">MAP_C</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">\rest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token constant" style="color:#36acaa">R</span><span class="token plain"> code </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CAR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PAIR</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="annotations">Annotations<a aria-hidden="true" class="hash-link" href="#annotations" title="Direct link to heading">‚Äã</a></h3><p>Michelson&#x27;s annotation mechanism provides ways to better track data on the stack and give additional type constraints. Annotations are only here to add constraints, i.e. they cannot turn an otherwise rejected program into an accepted one. The notable exception to this rule is for entrypoints: the semantics of the <code>CONTRACT</code> and <code>SELF</code> instructions vary depending on their constructor annotations, and some contract origination may fail due to invalid entrypoint constructor annotations.</p><p>Stack visualization tools, like the Michelson Emacs mode, print annotations associated with each type in the program, as propagated by the type checker as well as variable annotations on the types of elements in the stack. This is especially useful for debugging.</p><p>We distinguish three kinds of annotations:</p><ul><li><em>type annotations</em>, written <code>:type_annot</code> </li></ul><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pair </span><span class="token operator" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">point</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int </span><span class="token operator" style="color:#393A34">:</span><span class="token plain">x_pos</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int </span><span class="token operator" style="color:#393A34">:</span><span class="token plain">y_pos</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><em>variable annotations</em>, written <code>@var_annot</code></li></ul><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prim @v </span><span class="token operator" style="color:#393A34">:</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">%</span><span class="token plain">x arg1 arg2 </span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><em>field annotations</em> or constructors annotations, written <code>%field_annot</code></li></ul><div class="codeBlockContainer_K1bP language-js"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">or </span><span class="token operator" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">t</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int </span><span class="token operator" style="color:#393A34">%</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">or</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bool </span><span class="token operator" style="color:#393A34">%</span><span class="token constant" style="color:#36acaa">B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pair </span><span class="token operator" style="color:#393A34">%</span><span class="token constant" style="color:#36acaa">C</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nat </span><span class="token operator" style="color:#393A34">%</span><span class="token plain">n1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nat </span><span class="token operator" style="color:#393A34">%</span><span class="token plain">n2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Please visit the <a href="https://tezos.gitlab.io/007/michelson.html" target="_blank" rel="noopener noreferrer">reference pages</a> for more detail about annotations in the Michelson language.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://gitlab.com/tezos-paris-hub/opentezos/-/blob/main/docs/michelson/instructions-reference.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-05-31T20:13:56.000Z">5/31/2021</time></b> by <b>AymericBethencourt</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/opentezos/michelson/examples"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ <!-- -->Examples</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/opentezos/michelson/exam"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Exam<!-- --> ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#instructions" class="table-of-contents__link toc-highlight">Instructions</a><ul><li><a href="#stack-operations" class="table-of-contents__link toc-highlight">Stack operations</a></li><li><a href="#generic-comparison" class="table-of-contents__link toc-highlight">Generic comparison</a></li><li><a href="#operations-on-bool" class="table-of-contents__link toc-highlight">Operations on bool</a></li><li><a href="#operations-on-numbers" class="table-of-contents__link toc-highlight">Operations on numbers</a></li><li><a href="#operations-on-strings" class="table-of-contents__link toc-highlight">Operations on strings</a></li><li><a href="#control-structures" class="table-of-contents__link toc-highlight">Control structures</a></li><li><a href="#operations-on-pairs" class="table-of-contents__link toc-highlight">Operations on pairs</a></li><li><a href="#operations-on-sets" class="table-of-contents__link toc-highlight">Operations on sets</a></li><li><a href="#operations-on-optional-values" class="table-of-contents__link toc-highlight">Operations on optional values</a></li><li><a href="#operations-on-mapsbig_maps" class="table-of-contents__link toc-highlight">Operations on maps/big_maps</a></li><li><a href="#operations-on-unions" class="table-of-contents__link toc-highlight">Operations on unions</a></li><li><a href="#operations-on-lists" class="table-of-contents__link toc-highlight">Operations on lists</a></li><li><a href="#operations-on-timestamps" class="table-of-contents__link toc-highlight">Operations on timestamps</a></li><li><a href="#operations-on-mutez" class="table-of-contents__link toc-highlight">Operations on mutez</a></li><li><a href="#operations-on-contracts" class="table-of-contents__link toc-highlight">Operations on contracts</a></li><li><a href="#built-ins" class="table-of-contents__link toc-highlight">Built-ins</a></li><li><a href="#operations-on-bytes" class="table-of-contents__link toc-highlight">Operations on bytes</a></li><li><a href="#crypto-primitives" class="table-of-contents__link toc-highlight">Crypto primitives</a></li><li><a href="#macros-and-syntactic-sugar" class="table-of-contents__link toc-highlight">Macros and syntactic sugar</a></li><li><a href="#annotations" class="table-of-contents__link toc-highlight">Annotations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 OpenTezos.</div></div></div></footer></div>
<script src="/opentezos/assets/js/runtime~main.aaa8e9f6.js"></script>
<script src="/opentezos/assets/js/main.c790d287.js"></script>
</body>
</html>