<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Smart contracts | OpenTezos</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://opentezos.com/tezos-basics/smart-contracts"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Smart contracts | OpenTezos"><meta data-react-helmet="true" name="description" content="In this chapter, you will learn the basics of Tezos smart contracts. Their components and the workflow to deploy and use them on the Tezos blockchain."><meta data-react-helmet="true" property="og:description" content="In this chapter, you will learn the basics of Tezos smart contracts. Their components and the workflow to deploy and use them on the Tezos blockchain."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://opentezos.com/tezos-basics/smart-contracts"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/tezos-basics/smart-contracts" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://opentezos.com/tezos-basics/smart-contracts" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5fe771a9.css">
<link rel="preload" href="/assets/js/runtime~main.7bc54877.js" as="script">
<link rel="preload" href="/assets/js/main.af038137.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo-dark.svg" alt="OpenTezos" class="themedImage_1VuW themedImage--dark_hz6m"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://gitlab.com/tezos-paris-hub/opentezos/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Gitlab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE" style="margin-left:2px">üåô</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE" style="margin-left:1px">‚òÄÔ∏è</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/">Welcome</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/blockchain-basics">Blockchain Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/tezos-basics">Tezos Basics</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tezos-basics/smart-contracts">Smart contracts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/liquid-proof-of-stake">Liquid Proof-of-Stake</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/operations">Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/cli-and-rpc">CLI and RPC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/governance-on-chain">Governance on-chain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/voting">Voting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/history-of-amendments">History of amendments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/economics-and-rewards">Economics and rewards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tezos-basics/exam">Exam</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/deploy-a-node">Deploy a node</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/explorer">How to use an Explorer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/archetype">Archetype</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/smartpy">SmartPy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/ligo">LIGO</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/michelson">Michelson</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/dapp">Build a Dapp</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/baking">Baking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/defi">DeFi</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/formal-verification">Formal Verification</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/private">Private Blockchain</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/contribute">How to contribute</a></div></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Smart contracts</h1></header><p>In this chapter, you will learn the basics of Tezos smart contracts. Their components and the workflow to deploy and use them on the Tezos <em>blockchain</em>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="general-definition-of-a-tezos-smart-contract">General definition of a Tezos smart contract<a aria-hidden="true" class="hash-link" href="#general-definition-of-a-tezos-smart-contract" title="Direct link to heading">‚Äã</a></h2><p>A smart contract is a piece of code stored on the <em>blockchain</em>. It contains a <strong>set of instructions</strong> and <strong>rules</strong> to trigger them (see the <a href="/blockchain-basics/smart-contracts#definition-of-a-smart-contract">promises</a> from the &quot;<em>Blockchain Basics</em>&quot; module).</p><p>Once deployed (stored), it becomes <strong>immutable</strong>. A Tezos smart contract is deployed using an <strong>operation</strong> (note here the Tezos&#x27; vocabulary, we don&#x27;t talk about a &quot;transaction&quot; for a deployment like before). This operation still requires payment of fees.</p><p>So, because we embed the instructions and the rules inside the smart contract, they are <strong>immutable</strong> too. Though for smart contracts, the key difference with a transfer of coins is a user <em>can trigger the execution of the code without modifying it. Therefore, without moving it to another operation or block like coins</em>. It stays where it was stored <strong>forever</strong>.</p><p>Tezos doesn&#x27;t use an <a href="https://en.wikipedia.org/wiki/Unspent_transaction_output" target="_blank" rel="noopener noreferrer">UTXO model</a> (no &quot;<em>vaults</em>&quot;, see <em>Blockchain Basics</em>) but a <strong>stateful accounts</strong> one <a href="/tezos-basics/smart-contracts#references">[1]</a>.</p><p>Like in Ethereum, Tezos uses 2 types of accounts:</p><ol><li>Classic accounts with a primary address, to store tez (Íú©)</li><li>Smart contract accounts with an address, storing code and tez (Íú©)</li></ol><p>In Tezos vocabulary, &quot;<em>contracts</em>&quot; refers to both types in general. Actually each <em>contract</em> has a &quot;<strong><em>manager</em></strong>&quot;. Precisely, a classic account has an &quot;<strong><em>owner</em></strong>&quot;. If a contract has the &quot;<em>spendable</em>&quot; property, the manager is the entity allowed to spend funds from it.</p><p>Smart contracts can achieve different kinds of operations with coins and <em>other smart contracts</em>. They&#x27;re comparable to <em>automatic</em> <strong>sealed</strong> food and drink dispensers from the same company:  </p><ul><li>Each machine has a contract saying &quot;<em>Give me cryptocurrency, then I give you food or drink</em>&quot; (promises)</li><li>Each machine can have a different smart contract for various foods or drinks (see that as asset types)</li><li>There could be another smart contract gathering the cryptocurrency total for the company (from previous smart contracts)</li></ul><p>Each machine doesn&#x27;t operate until enough currency is delivered (<em>Gas</em>). Note that the <strong>quantities</strong> of foods or drinks changes while their <strong>types</strong> can&#x27;t (ever).</p><p>Of course, smart contracts like the Tezos ones go beyond this metaphor. Thanks to <em>transparency</em> and <em>immutability</em>, they allow an <strong>agreement</strong> to be secured between two or more parties. In this context, the concept of &quot;<a href="https://en.wikipedia.org/wiki/Lawrence_Lessig#%22Code_is_law%22" target="_blank" rel="noopener noreferrer">Code is Law</a>&quot; from <a href="https://en.wikipedia.org/wiki/Lawrence_Lessig" target="_blank" rel="noopener noreferrer"><em>Lawrence Lessig</em></a> is very appropriate.</p><p>For example, it is common to create financial instruments like various <em>tokens</em> (usually worth a fraction of the blockchain&#x27;s <em>coin</em>) with different usability and characteristics inside a multiple smart contracts system. Other more or less complex projects can propose <em>lending</em>, <em>stablecoins</em>, or <em>crowdfundings</em>.</p><p>In most cases, smart contracts remove <em>intermediates</em> and drastically reduce costs compared to classic paper contracts and their validations.</p><p>Notice that like any other, a Tezos smart contract can only run and interact with the blockchain it&#x27;s stored on (Bitcoin&#x27;s smart contracts are exceptions here). It can&#x27;t interact with the outside world. That&#x27;s where <em>decentralized applications</em> or &quot;<em>Dapps</em>&quot; come in because they provide interfaces for the outside world.</p><p>To build your own Dapp, please refer to the <a href="/dapp"><em>Build a Dapp</em></a> module.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="lifecycle-of-a-tezos-smart-contract">Lifecycle of a Tezos smart contract<a aria-hidden="true" class="hash-link" href="#lifecycle-of-a-tezos-smart-contract" title="Direct link to heading">‚Äã</a></h2><p>As we saw, a smart contract can only be deployed once but can be called many times. The Tezos smart contract lifecycle steps are two:</p><ol><li>Deployment</li><li>Interactions through calls</li></ol><h3 class="anchor anchorWithStickyNavbar_31ik" id="deployment-of-a-tezos-smart-contract">Deployment of a Tezos smart contract<a aria-hidden="true" class="hash-link" href="#deployment-of-a-tezos-smart-contract" title="Direct link to heading">‚Äã</a></h3><p>The deployment of a Tezos smart contract is named &quot;<strong>origination</strong>&quot;.</p><p>When a smart contract is deployed, an <strong>address</strong> and a corresponding <em>persistent space</em> called &quot;<strong>storage</strong>&quot; are allocated to this smart contract. The smart contract address is like its <em>identity</em> and <em>where</em> it lives on the ledger. Its storage is its <em>usable space</em>.</p><p>Once deployed, anyone or <em>anything</em> can call the smart contract (e.g. other contracts) with an <em>operation</em> (in Tezos vocabulary, <em>transactions</em> are a sub-type of <em>operations</em>; see more about them in the <a href="/tezos-basics/operations"><em>Operations</em></a> chapter) sent to its address with arguments. This call triggers the execution of the set of pre-defined instructions (promises).</p><p>The origination of a Tezos smart contract must define:</p><ul><li>A complex <strong>Parameter Type</strong> in the low-level <em>Michelson</em> language<br>List or tuple of each parameter type (see more below with high-level languages)</li><li><strong>Storage Type</strong></li><li><strong>Set of instructions</strong> in the low-level <em>Michelson</em> language</li></ul><p><img src="/assets/images/tezos_smart_contract_content-4b4e09f6ab4f8d27448052e03d51637a.svg"></p><small class="figure">FIGURE 1: Content of a Tezos smart contract</small><p>The CLI command &quot;<code>tezos-client originate</code>&quot; can be used to deploy a Tezos smart contract. Arguments are the following:</p><ul><li>Name of the smart contract</li><li>Michelson script containing: <ul><li>Parameter Type</li><li>Storage Type</li><li>Set of instructions</li></ul></li><li>Initial storage value</li><li>Amount of tez sent to the smart contract</li><li>An optional address of a delegate</li></ul><p>The command returns the newly deployed contract&#x27;s address (more detail in the <a href="/tezos-basics/cli-and-rpc">&quot;<em>CLI and RPC</em>&quot;</a> chapter).</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="code-of-a-tezos-smart-contract">Code of a Tezos smart contract<a aria-hidden="true" class="hash-link" href="#code-of-a-tezos-smart-contract" title="Direct link to heading">‚Äã</a></h3><p>The code of a smart contract is composed of Michelson instructions. Calls to the smart contract execute these instructions.</p><p>The execution of instructions results in a new storage &quot;<strong>state</strong>&quot;. The instructions define how to produce this new state. The instructions may also lead to other operations, including originations of other smart contracts, and of course, transactions.</p><p>You can find the full description of the Michelson language in the <a href="/michelson">Michelson module</a>.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="storage-of-a-tezos-smart-contract">Storage of a Tezos smart contract<a aria-hidden="true" class="hash-link" href="#storage-of-a-tezos-smart-contract" title="Direct link to heading">‚Äã</a></h3><p>During the origination, the process must specify the storage <strong>initial state</strong> (and type).</p><p>For more details, check out the <a href="/tezos-basics/economics-and-rewards">&quot;<em>Fees and Rewards</em>&quot;</a> chapter.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="call-of-a-tezos-smart-contract">Call of a Tezos smart contract<a aria-hidden="true" class="hash-link" href="#call-of-a-tezos-smart-contract" title="Direct link to heading">‚Äã</a></h3><p>A smart contract can be called by a classic account whose address starts with &quot;<strong>tz</strong>&quot; (more details in the &quot;<a href="/tezos-basics/operations"><em>Operations</em></a>&quot; chapter) or by a smart contract&#x27;s account whose address begins with &quot;<strong>KT1</strong>&quot;. The operation or transaction specifies <em>arguments</em>, that are ordered types. In the below example, we increase or decrease a value in the storage:</p><p><img src="/assets/images/invoke_smart_contract_wo_entrypoint-55cff55eeec0a70d6cc1fdabfb3a6558.svg"></p><small class="figure">FIGURE 2: Call of a smart contract triggering its code and modifying its storage&#x27;s state</small><p>One can use the Command Line Interface (CLI) provided by Tezos to interact with a node and make calls. The &quot;<code>tezos-client</code>&quot; application allows anyone to deploy and call Tezos smart contracts.</p><p>It is also possible to send requests to a node through RPC (Remote Procedure Call) via HTTP (more details in <a href="/tezos-basics/cli-and-rpc">&quot;<em>CLI and RPC</em>&quot;</a> chapter).</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="high-level-languages-for-tezos-smart-contracts-implementations">High-level languages for Tezos smart contracts implementations<a aria-hidden="true" class="hash-link" href="#high-level-languages-for-tezos-smart-contracts-implementations" title="Direct link to heading">‚Äã</a></h2><p>Michelson is a low-level stack-based language. Therefore its adoption is quite limited because most developers won&#x27;t take time to learn it. Several Michelson <em>compilers</em> have been developed to avoid this friction and led to several high-level languages closer to developers habits. For example: <a href="/smartpy"><em>SmartPy</em></a> (inspired by <em>Python</em>); <a href="/ligo"><em>LIGO</em></a> (inspired by <em>Camel</em> with a <em>Pascal</em>-like syntax); or <a href="https://serokell.io/project-morley" target="_blank" rel="noopener noreferrer"><em>Morley</em></a> (framework).</p><p>Depending on the high-level language used, a smart contract deployment also defines its <em>entrypoints</em> using the complex <strong>Parameter Type</strong>. These are special functions used to dispatch invocations of the smart contract. Each entrypoint is in charge of triggering an instruction. Below is the same example as before, abstracting the complex Parameter Type:</p><p><img src="/assets/images/invoke_smart_contract-fa1fe529f7ef74ba002ab4a0d9aedb80.svg"></p><small class="figure">FIGURE 3: Call of a smart contract triggering its entrypoints, code, and modifying its storage&#x27;s state</small><p>Each type and position of a parameter in the list (or tupple) allows you to define an entrypoint (a function). For instance, in our example, there are two parameters, hence two types. Both types are integers (to increase or decrease a value). Because the type is the same, its position (left, right, or index number) determines which entrypoint is correct.<br>
<!-- -->It could be:</p><ul><li>Left type: &quot;Increment&quot; entrypoint</li><li>Right type: &quot;Decrement&quot; entrypoint</li></ul><p>Below is another illustration of this process:</p><p><img src="/assets/images/tezos_smart_contract_deploy_invoke-2b8f22b5867b7594d6c8a72279ae8305.svg"></p><small class="figure">FIGURE 4: Deployment and call of a Tezos smart contract with high-level languages.</small><h2 class="anchor anchorWithStickyNavbar_31ik" id="smart-contracts-versioning">Smart contracts versioning<a aria-hidden="true" class="hash-link" href="#smart-contracts-versioning" title="Direct link to heading">‚Äã</a></h2><p>You need to remember the code of a smart contract is <strong>immutable</strong>. Only the storage state changes. Hence, to handle smart contracts <a href="https://en.wikipedia.org/wiki/Software_versioning" target="_blank" rel="noopener noreferrer">versioning</a> (handle new developments and versions of the smart contracts), you should think about <strong>implementations structures</strong> to allow transfer of information <strong>from old contracts to new contracts</strong>. If you don&#x27;t, you risk increasing errors and costs during the transfer.</p><p>Hopefully, the above high-level languages make this kind of complex implementation easier. We will present to you two patterns to build <strong>evolutive</strong> smart contracts or <em>Dapps</em>.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="lambda-pattern">Lambda pattern<a aria-hidden="true" class="hash-link" href="#lambda-pattern" title="Direct link to heading">‚Äã</a></h3><p>The Lambda pattern is based on <em>lambda functions</em>. These anonymous functions only have a mandatory <em>type</em> (function!); non-mandatory <em>parameters</em>; and non-mandatory <em>return values</em>. The idea is to exchange the <strong>body</strong> of a classic function with a <strong>lambda function</strong>. While the classic function is immutable, the lambda function is stored in the storage, therefore mutable.</p><p>Instead of simply sealing the classic function&#x27;s body as an immutable structure, you make it a mutable <em>data</em> of the storage.<br>
<!-- -->In an <strong>imaginary</strong> high-level language syntax:</p><ul><li><em>An entrypoint</em></li></ul><div class="codeBlockContainer_K1bP language-d"><div class="codeBlockContent_hGly d"><pre tabindex="0" class="prism-code language-d codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Entrypoint_for_doSomething(p1, ... , pP) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    doSomething(p1, ... , pP);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><em>The corresponding immutable function</em></li></ul><div class="codeBlockContainer_K1bP language-d"><div class="codeBlockContent_hGly d"><pre tabindex="0" class="prism-code language-d codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">function doSomething(p1, ... , pP) return (v1, ... , vR) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage.lambdaFunction();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><em>The lambda function in the storage as a variable</em></li></ul><div class="codeBlockContainer_K1bP language-d"><div class="codeBlockContent_hGly d"><pre tabindex="0" class="prism-code language-d codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">lambdaFunction = function (p1, ... , pP) return (v1, ... , vR) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    actual_instructions;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Warnings</strong>:  </p><blockquote><p>In this algorithmic example, almost all types are implicit, which limits the number of words. Furthermore, the syntax isn&#x27;t as functional as in languages used for Tezos smart contracts (e.g. <em>LIGO</em>).</p></blockquote><p><img src="/assets/images/lambda-pattern-3ccf88aee6cf480fd8fce045a0c3162e.svg">  </p><small class="figure">FIGURE 5: <i>Lambda pattern</i> illustration.</small><h3 class="anchor anchorWithStickyNavbar_31ik" id="data-proxy-pattern">Data-Proxy pattern<a aria-hidden="true" class="hash-link" href="#data-proxy-pattern" title="Direct link to heading">‚Äã</a></h3><p>The idea of the &quot;<em>Data-Proxy</em>&quot; pattern is pretty simple: separate the logic from the data into different smart contracts. Instead of duplicating and transferring the data into a new smart contract, we only update the logic smart contract.</p><p>The first smart contract is the Data smart contract. It stores important data, including the address and entrypoints of the Logic smart contract. It also plays a proxy role as any request always goes through it first. It usually doesn&#x27;t have a lot of functions. The mandatory functions set and retrieve its storage data (including new addresses for the new logic smart contracts).</p><p>When you need to update the logic (e.g. new features; corrections...) you only deploy a new logic smart contract and update the Data smart contract storage with the new address. See below fig. 6 for an update of the Logic smart contract from version 1.0 to 2.1.:</p><p><img src="/assets/images/data-proxy-f9f78c05148a91de1c7e1b8320e7dc25.svg">  </p><small class="figure">FIGURE 6: <i>Data-Proxy</i> pattern illustration.</small><p>Once the Data-Proxy architecture is in place, we can make the Data smart contract more dynamic with a Map structure and the Logic smart contract upgradable with a Lambda pattern.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="map-structure">Map structure<a aria-hidden="true" class="hash-link" href="#map-structure" title="Direct link to heading">‚Äã</a></h4><p>The idea is to make the Data smart contract storage more dynamic. We organize data with a &quot;data mapping&quot;. This mapping or &quot;map&quot; makes a classic &quot;Key / Value&quot; association between two data types. What&#x27;s interesting here is that it&#x27;s evolutive, even in the storage. Of course, the data types are fixed, but it is possible to add or remove pairs or change a <em>value</em> associated with the same <em>key</em>.</p><p>For example, in our Data smart contract, we can define a Map with versions&#x27; numbers as keys and logic smart contracts addresses as values:</p><p><img src="/assets/images/map-structure-example-4d6910371e10489fd5bb00cca18cca83.svg">  </p><small class="figure">FIGURE 4: Map structure example.</small><p>Note that even if a value or pair is deleted from a map, the blockchain ledger keeps the complete history of its state.<br>
<!-- -->In the versions&#x27; example, you can still see all versions&#x27; history (and addresses) using a block explorer.</p><p>The idea we described in this Data-Proxy pattern is actually a basic form of <a href="https://en.wikipedia.org/wiki/Modular_programming" target="_blank" rel="noopener noreferrer">modular programming</a>.</p><p>This pattern isn&#x27;t limited to 2 smart contracts only. You can imagine various architectures combining various patterns. For instance, you can imagine a central Data smart contract and multiple upgradable other smart contracts revolving around it. This example implies a single point of failure in the Data smart contract, but there are other questions you should keep in mind, like access rights (to get and set data, to upgrade logic, etc.).</p><p>These patterns aren&#x27;t magical and just allow more flexibility. You still need to think about the best architecture for your <em>dapp</em>. Patterns can still notably increase the deployment and <em>gaz</em> using fees.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="what-have-we-learned-so-far">What have we learned so far?<a aria-hidden="true" class="hash-link" href="#what-have-we-learned-so-far" title="Direct link to heading">‚Äã</a></h2><p>In this chapter, we described the Tezos smart contract&#x27;s main components and properties. We also described its lifecycle. We explained how to construct Tezos smart contracts using different patterns to make evolving <em>dapps</em> and handle efficient <em>versioning</em>.</p><p>In the next chapter, we will detail the Tezos consensus mechanism &quot;<em>Liquid Proof-of-Stake</em>&quot;.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="references">References<a aria-hidden="true" class="hash-link" href="#references" title="Direct link to heading">‚Äã</a></h2><p>[1]<!-- --> <a href="https://medium.com/nervosnetwork/my-comparison-between-the-utxo-and-account-model-821eb46691b2" target="_blank" rel="noopener noreferrer">https://medium.com/nervosnetwork/my-comparison-between-the-utxo-and-account-model-821eb46691b2</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://gitlab.com/tezos-paris-hub/opentezos/-/blob/main/docs/tezos-basics/smart-contracts.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-08-03T19:22:24.000Z">8/3/2021</time></b> by <b>Udit-Kapoor</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/tezos-basics"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ <!-- -->Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/tezos-basics/liquid-proof-of-stake"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Liquid Proof-of-Stake<!-- --> ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#general-definition-of-a-tezos-smart-contract" class="table-of-contents__link toc-highlight">General definition of a Tezos smart contract</a></li><li><a href="#lifecycle-of-a-tezos-smart-contract" class="table-of-contents__link toc-highlight">Lifecycle of a Tezos smart contract</a><ul><li><a href="#deployment-of-a-tezos-smart-contract" class="table-of-contents__link toc-highlight">Deployment of a Tezos smart contract</a></li><li><a href="#code-of-a-tezos-smart-contract" class="table-of-contents__link toc-highlight">Code of a Tezos smart contract</a></li><li><a href="#storage-of-a-tezos-smart-contract" class="table-of-contents__link toc-highlight">Storage of a Tezos smart contract</a></li><li><a href="#call-of-a-tezos-smart-contract" class="table-of-contents__link toc-highlight">Call of a Tezos smart contract</a></li></ul></li><li><a href="#high-level-languages-for-tezos-smart-contracts-implementations" class="table-of-contents__link toc-highlight">High-level languages for Tezos smart contracts implementations</a></li><li><a href="#smart-contracts-versioning" class="table-of-contents__link toc-highlight">Smart contracts versioning</a><ul><li><a href="#lambda-pattern" class="table-of-contents__link toc-highlight">Lambda pattern</a></li><li><a href="#data-proxy-pattern" class="table-of-contents__link toc-highlight">Data-Proxy pattern</a></li></ul></li><li><a href="#what-have-we-learned-so-far" class="table-of-contents__link toc-highlight">What have we learned so far?</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 OpenTezos.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.7bc54877.js"></script>
<script src="/assets/js/main.af038137.js"></script>
</body>
</html>