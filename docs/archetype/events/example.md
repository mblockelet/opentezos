---
id: event-example
title: Example
authors: Benoit Rognier
---

This page presents a complete simple example of event emission and reception.

## Setup

This example requires [node.js](https://nodejs.org/en/) and [`completium-cli`](https://completium.com/docs/cli) to be installed.

Set completium to work with testnet (ithaca protocol at the time of writing) with the following command:
```
$ completium-cli set endpoint https://ithacanet.api.tez.ie
```

The following commands init the example project:
```bash
$ mkdir event-example
$ cd event-example
$ npm init -y
$ npm i @completium/event-well-crank @completium/completium-cli
$ touch index.js emitter.arl
```

## Emitter contract

The emitter contract (`emitter.arl`) emits an event when the input natural integer is odd:

```archetype
archetype odd_emitter

event Odd {
  val : nat
}

entry isodd(v : nat) {
  if v % 2 = 1 then
    emit<Odd>({ v })
}
```

Deploy the contract with the following command:
```
$ completium-cli deploy emitter.arl
```

## Receiver app

The receiver program shall:
* define the `Odd` event handler function
* register the event handler
* start the crank

The `Odd` event type and register function are generated by completium:
```bash
$ completium-cli generate bindings js emitter.arl > bindings-emitter.ts
```

:::info
The typescript verion is also available with `ts` option.
:::

We can then import and use the bindings:

```javascript
import { runCrank } from '@completium/event-well-crank'
import { getContract } from '@completium/completium-cli'
import { register_Odd } from './bindings-emitter'

const handleOdd = e => {
  console.log(`Received the odd number ${e.val}`)
}

const runTest = async () => {
  const emitter = await getContract('emitter');
  register_Odd(emitter.address, handleOdd);
  await runCrank({
    verbose: true,
    endpoint: 'https://ithacanet.api.tez.ie',
    well: 'KT1UsVVireDXZE5R1waCeyKnYD178g2cVDji'
  })
}

runTest()
```

## Execute

Start the receiver aapplication with the following command:
```
$ node index.js
```

In verbose mode, the crank displays the block hashes read.

In another shell, call the emitter contract with the following:
```bash
$ completium-cli call emitter --arg '{ "v" : 43 }'
```

After a few blocks the message will appear in the receiver application shell:
```
Received the odd number 43
```